{"version":3,"file":"MissingAnnotationEmptyState.esm.js","sources":["../../../src/components/MissingAnnotationEmptyState/MissingAnnotationEmptyState.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Box from '@material-ui/core/Box';\nimport Button from '@material-ui/core/Button';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport React from 'react';\nimport { CodeSnippet, Link, EmptyState } from '@backstage/core-components';\nimport { Entity } from '@backstage/catalog-model';\nimport { useEntity } from '../../hooks';\n\n/** @public */\nexport type MissingAnnotationEmptyStateClassKey = 'code';\n\nconst useStyles = makeStyles(\n  theme => ({\n    code: {\n      borderRadius: 6,\n      margin: theme.spacing(2, 0),\n      background:\n        theme.palette.type === 'dark' ? '#444' : theme.palette.common.white,\n    },\n  }),\n  { name: 'BackstageMissingAnnotationEmptyState' },\n);\n\nfunction generateYamlExample(\n  annotations: string[],\n  entity?: Entity,\n): { yamlText: string; lineNumbers: number[] } {\n  const kind = entity?.kind || 'Component';\n  const name = entity?.metadata.name || 'example';\n  const type = entity?.spec?.type || 'website';\n  const owner = entity?.spec?.owner || 'user:default/guest';\n\n  const yamlText = `apiVersion: backstage.io/v1alpha1\nkind: ${kind}\nmetadata:\n  name: ${name}\n  annotations:${annotations.map(ann => `\\n    ${ann}: value`).join('')}\nspec:\n  type: ${type}\n  owner: ${owner}`;\n\n  let line = 6; // Line 6 is the line number that annotations are added to.\n  const lineNumbers: number[] = [];\n  annotations.forEach(() => {\n    lineNumbers.push(line);\n    line++;\n  });\n\n  return {\n    yamlText,\n    lineNumbers,\n  };\n}\n\nfunction generateDescription(annotations: string[], entityKind = 'Component') {\n  const isSingular = annotations.length <= 1;\n  return (\n    <>\n      The {isSingular ? 'annotation' : 'annotations'}{' '}\n      {annotations\n        .map(ann => <code>{ann}</code>)\n        .reduce((prev, curr) => (\n          <>\n            {prev}, {curr}\n          </>\n        ))}{' '}\n      {isSingular ? 'is' : 'are'} missing. You need to add the{' '}\n      {isSingular ? 'annotation' : 'annotations'} to your {entityKind} if you\n      want to enable this tool.\n    </>\n  );\n}\n\n/**\n * @public\n * Renders an empty state when an annotation is missing from an entity.\n */\nexport function MissingAnnotationEmptyState(props: {\n  annotation: string | string[];\n  readMoreUrl?: string;\n}) {\n  let entity: Entity | undefined;\n  try {\n    const entityContext = useEntity();\n    entity = entityContext.entity;\n  } catch (err) {\n    // ignore when entity context doesnt exist\n  }\n\n  const { annotation, readMoreUrl } = props;\n  const annotations = Array.isArray(annotation) ? annotation : [annotation];\n  const url =\n    readMoreUrl ||\n    'https://backstage.io/docs/features/software-catalog/well-known-annotations';\n  const classes = useStyles();\n\n  const entityKind = entity?.kind || 'Component';\n  const { yamlText, lineNumbers } = generateYamlExample(annotations, entity);\n  return (\n    <EmptyState\n      missing=\"field\"\n      title=\"Missing Annotation\"\n      description={generateDescription(annotations, entityKind)}\n      action={\n        <>\n          <Typography variant=\"body1\">\n            Add the annotation to your {entityKind} YAML as shown in the\n            highlighted example below:\n          </Typography>\n          <Box className={classes.code}>\n            <CodeSnippet\n              text={yamlText}\n              language=\"yaml\"\n              showLineNumbers\n              highlightedNumbers={lineNumbers}\n              customStyle={{ background: 'inherit', fontSize: '115%' }}\n            />\n          </Box>\n          <Button color=\"primary\" component={Link} to={url}>\n            Read more\n          </Button>\n        </>\n      }\n    />\n  );\n}\n"],"names":[],"mappings":"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"}