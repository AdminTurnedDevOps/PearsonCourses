{"version":3,"file":"filters.esm.js","sources":["../../src/utils/filters.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { EntityFilter } from '../types';\nimport {\n  EntityLifecycleFilter,\n  EntityNamespaceFilter,\n  EntityOrphanFilter,\n  EntityOwnerFilter,\n  EntityTagFilter,\n  EntityTextFilter,\n  EntityUserFilter,\n  UserListFilter,\n} from '../filters';\n\nexport interface CatalogFilters {\n  filter: Record<string, string | symbol | (string | symbol)[]>;\n  fullTextFilter?: {\n    term: string;\n  };\n}\n\nfunction isEntityTextFilter(t: EntityFilter): t is EntityTextFilter {\n  return !!(t as EntityTextFilter).getFullTextFilters;\n}\n\nexport function reduceCatalogFilters(filters: EntityFilter[]): CatalogFilters {\n  const condensedFilters = filters.reduce<CatalogFilters['filter']>(\n    (compoundFilter, filter) => {\n      return {\n        ...compoundFilter,\n        ...(filter.getCatalogFilters ? filter.getCatalogFilters() : {}),\n      };\n    },\n    {},\n  );\n\n  const fullTextFilter = filters.find(isEntityTextFilter)?.getFullTextFilters();\n  return { filter: condensedFilters, fullTextFilter };\n}\n\n/**\n * This function computes and returns an object containing the filters to be sent\n * to the backend. Any filter coming from `EntityKindFilter` and `EntityTypeFilter`, together\n * with custom filter set by the adopters is allowed. This function is used by `EntityListProvider`\n * and it won't be needed anymore in the future once pagination is implemented, as all the filters\n * will be applied backend-side.\n */\nexport function reduceBackendCatalogFilters(filters: EntityFilter[]) {\n  const backendCatalogFilters: Record<\n    string,\n    string | symbol | (string | symbol)[]\n  > = {};\n\n  filters.forEach(filter => {\n    if (\n      filter instanceof EntityTagFilter ||\n      filter instanceof EntityOwnerFilter ||\n      filter instanceof EntityLifecycleFilter ||\n      filter instanceof EntityNamespaceFilter ||\n      filter instanceof EntityUserFilter ||\n      filter instanceof EntityOrphanFilter ||\n      filter instanceof EntityTextFilter ||\n      filter instanceof UserListFilter\n    ) {\n      return;\n    }\n    Object.assign(backendCatalogFilters, filter.getCatalogFilters?.() || {});\n  });\n\n  return backendCatalogFilters;\n}\n\nexport function reduceEntityFilters(\n  filters: EntityFilter[],\n): (entity: Entity) => boolean {\n  return (entity: Entity) =>\n    filters.every(\n      filter => !filter.filterEntity || filter.filterEntity(entity),\n    );\n}\n"],"names":[],"mappings":";;AAoCA,SAAS,mBAAmB,CAAwC,EAAA;AAClE,EAAO,OAAA,CAAC,CAAE,CAAuB,CAAA,kBAAA;AACnC;AAEO,SAAS,qBAAqB,OAAyC,EAAA;AAC5E,EAAA,MAAM,mBAAmB,OAAQ,CAAA,MAAA;AAAA,IAC/B,CAAC,gBAAgB,MAAW,KAAA;AAC1B,MAAO,OAAA;AAAA,QACL,GAAG,cAAA;AAAA,QACH,GAAI,MAAO,CAAA,iBAAA,GAAoB,MAAO,CAAA,iBAAA,KAAsB;AAAC,OAC/D;AAAA,KACF;AAAA,IACA;AAAC,GACH;AAEA,EAAA,MAAM,cAAiB,GAAA,OAAA,CAAQ,IAAK,CAAA,kBAAkB,GAAG,kBAAmB,EAAA;AAC5E,EAAO,OAAA,EAAE,MAAQ,EAAA,gBAAA,EAAkB,cAAe,EAAA;AACpD;AASO,SAAS,4BAA4B,OAAyB,EAAA;AACnE,EAAA,MAAM,wBAGF,EAAC;AAEL,EAAA,OAAA,CAAQ,QAAQ,CAAU,MAAA,KAAA;AACxB,IAAA,IACE,MAAkB,YAAA,eAAA,IAClB,MAAkB,YAAA,iBAAA,IAClB,kBAAkB,qBAClB,IAAA,MAAA,YAAkB,qBAClB,IAAA,MAAA,YAAkB,oBAClB,MAAkB,YAAA,kBAAA,IAClB,MAAkB,YAAA,gBAAA,IAClB,kBAAkB,cAClB,EAAA;AACA,MAAA;AAAA;AAEF,IAAA,MAAA,CAAO,OAAO,qBAAuB,EAAA,MAAA,CAAO,iBAAoB,IAAA,IAAK,EAAE,CAAA;AAAA,GACxE,CAAA;AAED,EAAO,OAAA,qBAAA;AACT;AAEO,SAAS,oBACd,OAC6B,EAAA;AAC7B,EAAO,OAAA,CAAC,WACN,OAAQ,CAAA,KAAA;AAAA,IACN,YAAU,CAAC,MAAA,CAAO,YAAgB,IAAA,MAAA,CAAO,aAAa,MAAM;AAAA,GAC9D;AACJ;;;;"}