{"version":3,"file":"utils.cjs.js","sources":["../../src/sources/utils.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Parser } from './types';\nimport yaml from 'yaml';\n\n/** @internal */\nexport async function waitOrAbort<T>(\n  promise: PromiseLike<T>,\n  signal?: AbortSignal | Array<AbortSignal | undefined>,\n): Promise<[ok: true, value: T] | [ok: false]> {\n  const signals = [signal].flat().filter((x): x is AbortSignal => !!x);\n  return new Promise((resolve, reject) => {\n    if (signals.some(s => s.aborted)) {\n      resolve([false]);\n    }\n    const onAbort = () => {\n      resolve([false]);\n    };\n    promise.then(\n      value => {\n        resolve([true, value]);\n        signals.forEach(s => s.removeEventListener('abort', onAbort));\n      },\n      error => {\n        reject(error);\n        signals.forEach(s => s.removeEventListener('abort', onAbort));\n      },\n    );\n    signals.forEach(s => s.addEventListener('abort', onAbort));\n  });\n}\n\n/** @internal */\nexport const parseYamlContent: Parser = async ({ contents }) => {\n  const parsed = yaml.parse(contents);\n  return { result: parsed === null ? undefined : parsed };\n};\n"],"names":["yaml"],"mappings":";;;;;;;;AAoBsB,eAAA,WAAA,CACpB,SACA,MAC6C,EAAA;AAC7C,EAAM,MAAA,OAAA,GAAU,CAAC,MAAM,CAAE,CAAA,IAAA,EAAO,CAAA,MAAA,CAAO,CAAC,CAAA,KAAwB,CAAC,CAAC,CAAC,CAAA;AACnE,EAAA,OAAO,IAAI,OAAA,CAAQ,CAAC,OAAA,EAAS,MAAW,KAAA;AACtC,IAAA,IAAI,OAAQ,CAAA,IAAA,CAAK,CAAK,CAAA,KAAA,CAAA,CAAE,OAAO,CAAG,EAAA;AAChC,MAAQ,OAAA,CAAA,CAAC,KAAK,CAAC,CAAA;AAAA;AAEjB,IAAA,MAAM,UAAU,MAAM;AACpB,MAAQ,OAAA,CAAA,CAAC,KAAK,CAAC,CAAA;AAAA,KACjB;AACA,IAAQ,OAAA,CAAA,IAAA;AAAA,MACN,CAAS,KAAA,KAAA;AACP,QAAQ,OAAA,CAAA,CAAC,IAAM,EAAA,KAAK,CAAC,CAAA;AACrB,QAAA,OAAA,CAAQ,QAAQ,CAAK,CAAA,KAAA,CAAA,CAAE,mBAAoB,CAAA,OAAA,EAAS,OAAO,CAAC,CAAA;AAAA,OAC9D;AAAA,MACA,CAAS,KAAA,KAAA;AACP,QAAA,MAAA,CAAO,KAAK,CAAA;AACZ,QAAA,OAAA,CAAQ,QAAQ,CAAK,CAAA,KAAA,CAAA,CAAE,mBAAoB,CAAA,OAAA,EAAS,OAAO,CAAC,CAAA;AAAA;AAC9D,KACF;AACA,IAAA,OAAA,CAAQ,QAAQ,CAAK,CAAA,KAAA,CAAA,CAAE,gBAAiB,CAAA,OAAA,EAAS,OAAO,CAAC,CAAA;AAAA,GAC1D,CAAA;AACH;AAGO,MAAM,gBAA2B,GAAA,OAAO,EAAE,QAAA,EAAe,KAAA;AAC9D,EAAM,MAAA,MAAA,GAASA,qBAAK,CAAA,KAAA,CAAM,QAAQ,CAAA;AAClC,EAAA,OAAO,EAAE,MAAA,EAAQ,MAAW,KAAA,IAAA,GAAO,SAAY,MAAO,EAAA;AACxD;;;;;"}