{"version":3,"file":"dbUtil.cjs.js","sources":["../../../src/scaffolder/tasks/dbUtil.ts"],"sourcesContent":["/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Knex } from 'knex';\n\nexport const intervalFromNowTill = (timeoutS: number, knex: Knex) => {\n  let heartbeatInterval = knex.raw(`? - interval '${timeoutS} seconds'`, [\n    knex.fn.now(),\n  ]);\n  if (knex.client.config.client.includes('mysql')) {\n    heartbeatInterval = knex.raw(\n      `date_sub(now(), interval ${timeoutS} second)`,\n    );\n  } else if (knex.client.config.client.includes('sqlite3')) {\n    heartbeatInterval = knex.raw(`datetime('now', ?)`, [\n      `-${timeoutS} seconds`,\n    ]);\n  }\n  return heartbeatInterval;\n};\n"],"names":[],"mappings":";;AAiBa,MAAA,mBAAA,GAAsB,CAAC,QAAA,EAAkB,IAAe,KAAA;AACnE,EAAA,IAAI,iBAAoB,GAAA,IAAA,CAAK,GAAI,CAAA,CAAA,cAAA,EAAiB,QAAQ,CAAa,SAAA,CAAA,EAAA;AAAA,IACrE,IAAA,CAAK,GAAG,GAAI;AAAA,GACb,CAAA;AACD,EAAA,IAAI,KAAK,MAAO,CAAA,MAAA,CAAO,MAAO,CAAA,QAAA,CAAS,OAAO,CAAG,EAAA;AAC/C,IAAA,iBAAA,GAAoB,IAAK,CAAA,GAAA;AAAA,MACvB,4BAA4B,QAAQ,CAAA,QAAA;AAAA,KACtC;AAAA,aACS,IAAK,CAAA,MAAA,CAAO,OAAO,MAAO,CAAA,QAAA,CAAS,SAAS,CAAG,EAAA;AACxD,IAAoB,iBAAA,GAAA,IAAA,CAAK,IAAI,CAAsB,kBAAA,CAAA,EAAA;AAAA,MACjD,IAAI,QAAQ,CAAA,QAAA;AAAA,KACb,CAAA;AAAA;AAEH,EAAO,OAAA,iBAAA;AACT;;;;"}