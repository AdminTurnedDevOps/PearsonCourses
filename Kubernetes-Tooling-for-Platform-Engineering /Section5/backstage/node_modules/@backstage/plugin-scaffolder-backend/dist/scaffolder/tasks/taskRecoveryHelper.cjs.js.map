{"version":3,"file":"taskRecoveryHelper.cjs.js","sources":["../../../src/scaffolder/tasks/taskRecoveryHelper.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { SerializedTaskEvent } from '@backstage/plugin-scaffolder-node';\nimport { TaskRecoverStrategy } from '@backstage/plugin-scaffolder-common';\n\nexport const trimEventsTillLastRecovery = (\n  events: SerializedTaskEvent[],\n): { events: SerializedTaskEvent[] } => {\n  const recoveredEventInd = events\n    .slice()\n    .reverse()\n    .findIndex(event => event.type === 'recovered');\n\n  if (recoveredEventInd >= 0) {\n    const ind = events.length - recoveredEventInd - 1;\n    const { recoverStrategy } = events[ind].body as {\n      recoverStrategy: TaskRecoverStrategy;\n    };\n    if (recoverStrategy === 'startOver') {\n      return {\n        events: recoveredEventInd === 0 ? [] : events.slice(ind),\n      };\n    }\n  }\n\n  return { events };\n};\n"],"names":[],"mappings":";;AAmBa,MAAA,0BAAA,GAA6B,CACxC,MACsC,KAAA;AACtC,EAAM,MAAA,iBAAA,GAAoB,MACvB,CAAA,KAAA,EACA,CAAA,OAAA,GACA,SAAU,CAAA,CAAA,KAAA,KAAS,KAAM,CAAA,IAAA,KAAS,WAAW,CAAA;AAEhD,EAAA,IAAI,qBAAqB,CAAG,EAAA;AAC1B,IAAM,MAAA,GAAA,GAAM,MAAO,CAAA,MAAA,GAAS,iBAAoB,GAAA,CAAA;AAChD,IAAA,MAAM,EAAE,eAAA,EAAoB,GAAA,MAAA,CAAO,GAAG,CAAE,CAAA,IAAA;AAGxC,IAAA,IAAI,oBAAoB,WAAa,EAAA;AACnC,MAAO,OAAA;AAAA,QACL,QAAQ,iBAAsB,KAAA,CAAA,GAAI,EAAK,GAAA,MAAA,CAAO,MAAM,GAAG;AAAA,OACzD;AAAA;AACF;AAGF,EAAA,OAAO,EAAE,MAAO,EAAA;AAClB;;;;"}