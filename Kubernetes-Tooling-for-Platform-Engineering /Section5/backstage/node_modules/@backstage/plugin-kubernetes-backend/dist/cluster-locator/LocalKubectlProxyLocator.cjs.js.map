{"version":3,"file":"LocalKubectlProxyLocator.cjs.js","sources":["../../src/cluster-locator/LocalKubectlProxyLocator.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ANNOTATION_KUBERNETES_AUTH_PROVIDER } from '@backstage/plugin-kubernetes-common';\nimport {\n  ClusterDetails,\n  KubernetesClustersSupplier,\n} from '@backstage/plugin-kubernetes-node';\nimport dns from 'node:dns';\n\nexport class LocalKubectlProxyClusterLocator\n  implements KubernetesClustersSupplier\n{\n  private readonly clusterDetails: ClusterDetails[];\n  // verbatim: when false, IPv4 addresses are placed before IPv6 addresses, ignoring the order from the DNS resolver\n  // By default kubectl proxy listens on 127.0.0.1 instead of [::1]\n  private lookupPromise = dns.promises.lookup('localhost', { verbatim: false });\n\n  public constructor() {\n    this.clusterDetails = [\n      {\n        name: 'local',\n        url: 'http://localhost:8001',\n        authMetadata: {\n          [ANNOTATION_KUBERNETES_AUTH_PROVIDER]: 'localKubectlProxy',\n        },\n        skipMetricsLookup: true,\n      },\n    ];\n  }\n\n  async getClusters(): Promise<ClusterDetails[]> {\n    const lookupResolution = await this.lookupPromise;\n    this.clusterDetails[0].url = `http://${lookupResolution.address}:8001`;\n    return this.clusterDetails;\n  }\n}\n"],"names":["dns","ANNOTATION_KUBERNETES_AUTH_PROVIDER"],"mappings":";;;;;;;;;AAuBO,MAAM,+BAEb,CAAA;AAAA,EACmB,cAAA;AAAA;AAAA;AAAA,EAGT,aAAA,GAAgBA,qBAAI,QAAS,CAAA,MAAA,CAAO,aAAa,EAAE,QAAA,EAAU,OAAO,CAAA;AAAA,EAErE,WAAc,GAAA;AACnB,IAAA,IAAA,CAAK,cAAiB,GAAA;AAAA,MACpB;AAAA,QACE,IAAM,EAAA,OAAA;AAAA,QACN,GAAK,EAAA,uBAAA;AAAA,QACL,YAAc,EAAA;AAAA,UACZ,CAACC,0DAAmC,GAAG;AAAA,SACzC;AAAA,QACA,iBAAmB,EAAA;AAAA;AACrB,KACF;AAAA;AACF,EAEA,MAAM,WAAyC,GAAA;AAC7C,IAAM,MAAA,gBAAA,GAAmB,MAAM,IAAK,CAAA,aAAA;AACpC,IAAA,IAAA,CAAK,eAAe,CAAC,CAAA,CAAE,GAAM,GAAA,CAAA,OAAA,EAAU,iBAAiB,OAAO,CAAA,KAAA,CAAA;AAC/D,IAAA,OAAO,IAAK,CAAA,cAAA;AAAA;AAEhB;;;;"}