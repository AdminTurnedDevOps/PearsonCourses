{"version":3,"file":"addons.esm.js","sources":["../src/addons.tsx"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback } from 'react';\nimport { useOutlet } from 'react-router-dom';\n\nimport {\n  attachComponentData,\n  createReactExtension,\n  ElementCollection,\n  Extension,\n  useElementFilter,\n} from '@backstage/core-plugin-api';\n\nimport { TechDocsAddonLocations, TechDocsAddonOptions } from './types';\n\n/**\n * Key for each addon.\n * @public\n */\nexport const TECHDOCS_ADDONS_KEY = 'techdocs.addons.addon.v1';\n\n/**\n * Marks the `<TechDocsAddons>` registry component.\n * @public\n */\nexport const TECHDOCS_ADDONS_WRAPPER_KEY = 'techdocs.addons.wrapper.v1';\n\n/**\n * TechDocs Addon registry.\n * @public\n */\nexport const TechDocsAddons: React.ComponentType<\n  React.PropsWithChildren<{}>\n> = () => null;\n\nattachComponentData(TechDocsAddons, TECHDOCS_ADDONS_WRAPPER_KEY, true);\n\nconst getDataKeyByName = (name: string) => {\n  return `${TECHDOCS_ADDONS_KEY}.${name.toLocaleLowerCase('en-US')}`;\n};\n\n/**\n * Create a TechDocs addon overload signature without props.\n * @public\n */\nexport function createTechDocsAddonExtension(\n  options: TechDocsAddonOptions,\n): Extension<() => JSX.Element | null>;\n\n/**\n * Create a TechDocs addon overload signature with props.\n * @public\n */\nexport function createTechDocsAddonExtension<TComponentProps>(\n  options: TechDocsAddonOptions<TComponentProps>,\n): Extension<(props: TComponentProps) => JSX.Element | null>;\n\n/**\n * Create a TechDocs addon implementation.\n * @public\n */\nexport function createTechDocsAddonExtension<\n  TComponentProps extends React.PropsWithChildren<{}>,\n>(\n  options: TechDocsAddonOptions<TComponentProps>,\n): Extension<(props: TComponentProps) => JSX.Element | null> {\n  const { name, component: TechDocsAddon } = options;\n  return createReactExtension({\n    name,\n    component: {\n      sync: (props: TComponentProps) => <TechDocsAddon {...props} />,\n    },\n    data: {\n      [TECHDOCS_ADDONS_KEY]: options,\n      [getDataKeyByName(name)]: true,\n    },\n  });\n}\n\nconst getTechDocsAddonByName = (\n  collection: ElementCollection,\n  key: string,\n): JSX.Element | undefined => {\n  return collection.selectByComponentData({ key }).getElements()[0];\n};\n\nconst getAllTechDocsAddons = (collection: ElementCollection) => {\n  return collection\n    .selectByComponentData({\n      key: TECHDOCS_ADDONS_WRAPPER_KEY,\n    })\n    .selectByComponentData({\n      key: TECHDOCS_ADDONS_KEY,\n    });\n};\n\nconst getAllTechDocsAddonsData = (collection: ElementCollection) => {\n  return collection\n    .selectByComponentData({\n      key: TECHDOCS_ADDONS_WRAPPER_KEY,\n    })\n    .findComponentData<TechDocsAddonOptions>({\n      key: TECHDOCS_ADDONS_KEY,\n    });\n};\n\n/**\n * hook to use addons in components\n * @public\n */\nexport const useTechDocsAddons = () => {\n  const node = useOutlet();\n  const collection = useElementFilter(node, getAllTechDocsAddons);\n  const options = useElementFilter(node, getAllTechDocsAddonsData);\n\n  const findAddonByData = useCallback(\n    (data: TechDocsAddonOptions | undefined) => {\n      if (!collection || !data) return null;\n      const nameKey = getDataKeyByName(data.name);\n      return getTechDocsAddonByName(collection, nameKey) ?? null;\n    },\n    [collection],\n  );\n\n  const renderComponentByName = useCallback(\n    (name: string) => {\n      const data = options.find(option => option.name === name);\n      return data ? findAddonByData(data) : null;\n    },\n    [options, findAddonByData],\n  );\n\n  const renderComponentsByLocation = useCallback(\n    (location: keyof typeof TechDocsAddonLocations) => {\n      const data = options.filter(option => option.location === location);\n      return data.length ? data.map(findAddonByData) : null;\n    },\n    [options, findAddonByData],\n  );\n\n  return { renderComponentByName, renderComponentsByLocation };\n};\n"],"names":[],"mappings":"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"}