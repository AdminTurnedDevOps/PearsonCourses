{"version":3,"file":"globalObject.esm.js","sources":["../../src/lib/globalObject.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nfunction getGlobalObject() {\n  if (typeof window !== 'undefined' && window.Math === Math) {\n    return window;\n  }\n  // eslint-disable-next-line no-restricted-globals\n  if (typeof self !== 'undefined' && self.Math === Math) {\n    // eslint-disable-next-line no-restricted-globals\n    return self;\n  }\n  // eslint-disable-next-line no-new-func\n  return Function('return this')();\n}\n\nconst globalObject = getGlobalObject();\n\nconst makeKey = (id: string) => `__@backstage/${id}__`;\n\n/**\n * Serializes access to a global singleton value, with the first caller creating the value.\n *\n * @public\n */\nexport function getOrCreateGlobalSingleton<T>(\n  id: string,\n  supplier: () => T,\n): T {\n  const key = makeKey(id);\n\n  let value = globalObject[key];\n  if (value) {\n    return value;\n  }\n\n  value = supplier();\n  globalObject[key] = value;\n  return value;\n}\n"],"names":[],"mappings":"AAiBA,SAAS,eAAkB,GAAA;AACzB,EAAA,IAAI,OAAO,MAAA,KAAW,WAAe,IAAA,MAAA,CAAO,SAAS,IAAM,EAAA;AACzD,IAAO,OAAA,MAAA,CAAA;AAAA,GACT;AAEA,EAAA,IAAI,OAAO,IAAA,KAAS,WAAe,IAAA,IAAA,CAAK,SAAS,IAAM,EAAA;AAErD,IAAO,OAAA,IAAA,CAAA;AAAA,GACT;AAEA,EAAO,OAAA,QAAA,CAAS,aAAa,CAAE,EAAA,CAAA;AACjC,CAAA;AAEA,MAAM,eAAe,eAAgB,EAAA,CAAA;AAErC,MAAM,OAAU,GAAA,CAAC,EAAe,KAAA,CAAA,aAAA,EAAgB,EAAE,CAAA,EAAA,CAAA,CAAA;AAOlC,SAAA,0BAAA,CACd,IACA,QACG,EAAA;AACH,EAAM,MAAA,GAAA,GAAM,QAAQ,EAAE,CAAA,CAAA;AAEtB,EAAI,IAAA,KAAA,GAAQ,aAAa,GAAG,CAAA,CAAA;AAC5B,EAAA,IAAI,KAAO,EAAA;AACT,IAAO,OAAA,KAAA,CAAA;AAAA,GACT;AAEA,EAAA,KAAA,GAAQ,QAAS,EAAA,CAAA;AACjB,EAAA,YAAA,CAAa,GAAG,CAAI,GAAA,KAAA,CAAA;AACpB,EAAO,OAAA,KAAA,CAAA;AACT;;;;"}