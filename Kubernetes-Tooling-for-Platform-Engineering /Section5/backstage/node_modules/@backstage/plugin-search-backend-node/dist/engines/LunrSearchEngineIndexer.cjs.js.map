{"version":3,"file":"LunrSearchEngineIndexer.cjs.js","sources":["../../src/engines/LunrSearchEngineIndexer.ts"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { IndexableDocument } from '@backstage/plugin-search-common';\nimport lunr from 'lunr';\nimport { BatchSearchEngineIndexer } from '../indexing';\n\n/**\n * Lunr specific search engine indexer\n * @public\n */\nexport class LunrSearchEngineIndexer extends BatchSearchEngineIndexer {\n  private schemaInitialized = false;\n  private builder: lunr.Builder;\n  private docStore: Record<string, IndexableDocument> = {};\n\n  constructor() {\n    super({ batchSize: 1000 });\n\n    this.builder = new lunr.Builder();\n    this.builder.pipeline.add(lunr.trimmer, lunr.stopWordFilter, lunr.stemmer);\n    this.builder.searchPipeline.add(lunr.stemmer);\n    this.builder.metadataWhitelist = ['position'];\n  }\n\n  // No async initialization required.\n  async initialize(): Promise<void> {}\n  async finalize(): Promise<void> {}\n\n  async index(documents: IndexableDocument[]): Promise<void> {\n    if (!this.schemaInitialized) {\n      // Make this lunr index aware of all relevant fields.\n      Object.keys(documents[0]).forEach(field => {\n        this.builder.field(field);\n      });\n\n      // Set \"location\" field as reference field\n      this.builder.ref('location');\n\n      this.schemaInitialized = true;\n    }\n\n    documents.forEach(document => {\n      // Add document to Lunar index\n      this.builder.add(document);\n\n      // Store documents in memory to be able to look up document using the ref during query time\n      // This is not how you should implement your SearchEngine implementation! Do not copy!\n      this.docStore[document.location] = document;\n    });\n  }\n\n  buildIndex() {\n    return this.builder.build();\n  }\n\n  getDocumentStore() {\n    return this.docStore;\n  }\n}\n"],"names":["BatchSearchEngineIndexer","lunr"],"mappings":";;;;;;;;;;;AAwBO,MAAM,gCAAgCA,iDAAyB,CAAA;AAAA,EAC5D,iBAAoB,GAAA,KAAA;AAAA,EACpB,OAAA;AAAA,EACA,WAA8C,EAAC;AAAA,EAEvD,WAAc,GAAA;AACZ,IAAM,KAAA,CAAA,EAAE,SAAW,EAAA,GAAA,EAAM,CAAA;AAEzB,IAAK,IAAA,CAAA,OAAA,GAAU,IAAIC,qBAAA,CAAK,OAAQ,EAAA;AAChC,IAAK,IAAA,CAAA,OAAA,CAAQ,SAAS,GAAI,CAAAA,qBAAA,CAAK,SAASA,qBAAK,CAAA,cAAA,EAAgBA,sBAAK,OAAO,CAAA;AACzE,IAAA,IAAA,CAAK,OAAQ,CAAA,cAAA,CAAe,GAAI,CAAAA,qBAAA,CAAK,OAAO,CAAA;AAC5C,IAAK,IAAA,CAAA,OAAA,CAAQ,iBAAoB,GAAA,CAAC,UAAU,CAAA;AAAA;AAC9C;AAAA,EAGA,MAAM,UAA4B,GAAA;AAAA;AAAC,EACnC,MAAM,QAA0B,GAAA;AAAA;AAAC,EAEjC,MAAM,MAAM,SAA+C,EAAA;AACzD,IAAI,IAAA,CAAC,KAAK,iBAAmB,EAAA;AAE3B,MAAA,MAAA,CAAO,KAAK,SAAU,CAAA,CAAC,CAAC,CAAA,CAAE,QAAQ,CAAS,KAAA,KAAA;AACzC,QAAK,IAAA,CAAA,OAAA,CAAQ,MAAM,KAAK,CAAA;AAAA,OACzB,CAAA;AAGD,MAAK,IAAA,CAAA,OAAA,CAAQ,IAAI,UAAU,CAAA;AAE3B,MAAA,IAAA,CAAK,iBAAoB,GAAA,IAAA;AAAA;AAG3B,IAAA,SAAA,CAAU,QAAQ,CAAY,QAAA,KAAA;AAE5B,MAAK,IAAA,CAAA,OAAA,CAAQ,IAAI,QAAQ,CAAA;AAIzB,MAAK,IAAA,CAAA,QAAA,CAAS,QAAS,CAAA,QAAQ,CAAI,GAAA,QAAA;AAAA,KACpC,CAAA;AAAA;AACH,EAEA,UAAa,GAAA;AACX,IAAO,OAAA,IAAA,CAAK,QAAQ,KAAM,EAAA;AAAA;AAC5B,EAEA,gBAAmB,GAAA;AACjB,IAAA,OAAO,IAAK,CAAA,QAAA;AAAA;AAEhB;;;;"}