{"version":3,"file":"validation.esm.js","sources":["../../../../src/components/fields/RepoUrlPicker/validation.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FieldValidation } from '@rjsf/utils';\nimport { ApiHolder } from '@backstage/core-plugin-api';\nimport { scmIntegrationsApiRef } from '@backstage/integration-react';\n\n/**\n * The validation function for the `repoUrl` that is returned from the\n * field extension. Ensures that you have all the required fields filled for\n * the different providers that exist.\n *\n * @public\n */\nexport const repoPickerValidation = (\n  value: string,\n  validation: FieldValidation,\n  context: { apiHolder: ApiHolder },\n) => {\n  try {\n    const { host, searchParams } = new URL(`https://${value}`);\n\n    const integrationApi = context.apiHolder.get(scmIntegrationsApiRef);\n\n    if (!host) {\n      validation.addError(\n        'Incomplete repository location provided, host not provided',\n      );\n    } else {\n      if (integrationApi?.byHost(host)?.type === 'bitbucket') {\n        // workspace is only applicable for bitbucket cloud\n        if (host === 'bitbucket.org' && !searchParams.get('workspace')) {\n          validation.addError(\n            'Incomplete repository location provided, workspace not provided',\n          );\n        }\n\n        if (!searchParams.get('project')) {\n          validation.addError(\n            'Incomplete repository location provided, project not provided',\n          );\n        }\n      } else if (integrationApi?.byHost(host)?.type === 'azure') {\n        if (!searchParams.get('project')) {\n          validation.addError(\n            'Incomplete repository location provided, project not provided',\n          );\n        }\n      }\n      // For anything other than bitbucket, azure, and gerrit\n      else if (integrationApi?.byHost(host)?.type !== 'gerrit') {\n        if (!searchParams.get('owner')) {\n          validation.addError(\n            'Incomplete repository location provided, owner not provided',\n          );\n        }\n      }\n\n      // Do this for all hosts\n      if (!searchParams.get('repo')) {\n        validation.addError(\n          'Incomplete repository location provided, repo not provided',\n        );\n      }\n    }\n  } catch {\n    validation.addError('Unable to parse the Repository URL');\n  }\n};\n"],"names":[],"mappings":";;AA2BO,MAAM,oBAAuB,GAAA,CAClC,KACA,EAAA,UAAA,EACA,OACG,KAAA;AACH,EAAI,IAAA;AACF,IAAM,MAAA,EAAE,MAAM,YAAa,EAAA,GAAI,IAAI,GAAI,CAAA,CAAA,QAAA,EAAW,KAAK,CAAE,CAAA,CAAA;AAEzD,IAAA,MAAM,cAAiB,GAAA,OAAA,CAAQ,SAAU,CAAA,GAAA,CAAI,qBAAqB,CAAA;AAElE,IAAA,IAAI,CAAC,IAAM,EAAA;AACT,MAAW,UAAA,CAAA,QAAA;AAAA,QACT;AAAA,OACF;AAAA,KACK,MAAA;AACL,MAAA,IAAI,cAAgB,EAAA,MAAA,CAAO,IAAI,CAAA,EAAG,SAAS,WAAa,EAAA;AAEtD,QAAA,IAAI,SAAS,eAAmB,IAAA,CAAC,YAAa,CAAA,GAAA,CAAI,WAAW,CAAG,EAAA;AAC9D,UAAW,UAAA,CAAA,QAAA;AAAA,YACT;AAAA,WACF;AAAA;AAGF,QAAA,IAAI,CAAC,YAAA,CAAa,GAAI,CAAA,SAAS,CAAG,EAAA;AAChC,UAAW,UAAA,CAAA,QAAA;AAAA,YACT;AAAA,WACF;AAAA;AACF,iBACS,cAAgB,EAAA,MAAA,CAAO,IAAI,CAAA,EAAG,SAAS,OAAS,EAAA;AACzD,QAAA,IAAI,CAAC,YAAA,CAAa,GAAI,CAAA,SAAS,CAAG,EAAA;AAChC,UAAW,UAAA,CAAA,QAAA;AAAA,YACT;AAAA,WACF;AAAA;AACF,iBAGO,cAAgB,EAAA,MAAA,CAAO,IAAI,CAAA,EAAG,SAAS,QAAU,EAAA;AACxD,QAAA,IAAI,CAAC,YAAA,CAAa,GAAI,CAAA,OAAO,CAAG,EAAA;AAC9B,UAAW,UAAA,CAAA,QAAA;AAAA,YACT;AAAA,WACF;AAAA;AACF;AAIF,MAAA,IAAI,CAAC,YAAA,CAAa,GAAI,CAAA,MAAM,CAAG,EAAA;AAC7B,QAAW,UAAA,CAAA,QAAA;AAAA,UACT;AAAA,SACF;AAAA;AACF;AACF,GACM,CAAA,MAAA;AACN,IAAA,UAAA,CAAW,SAAS,oCAAoC,CAAA;AAAA;AAE5D;;;;"}