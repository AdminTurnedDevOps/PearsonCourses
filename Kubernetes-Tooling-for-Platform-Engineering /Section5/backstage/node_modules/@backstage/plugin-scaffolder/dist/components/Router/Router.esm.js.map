{"version":3,"file":"Router.esm.js","sources":["../../../src/components/Router/Router.tsx"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { PropsWithChildren } from 'react';\nimport { Routes, Route, useOutlet } from 'react-router-dom';\n\nimport {\n  FieldExtensionOptions,\n  FormProps,\n  ReviewStepProps,\n  TemplateGroupFilter,\n} from '@backstage/plugin-scaffolder-react';\nimport {\n  ScaffolderTaskOutput,\n  SecretsContextProvider,\n  useCustomFieldExtensions,\n  useCustomLayouts,\n} from '@backstage/plugin-scaffolder-react';\n\nimport { TemplateEntityV1beta3 } from '@backstage/plugin-scaffolder-common';\nimport { DEFAULT_SCAFFOLDER_FIELD_EXTENSIONS } from '../../extensions/default';\n\nimport {\n  actionsRouteRef,\n  editorRouteRef,\n  customFieldsRouteRef,\n  editRouteRef,\n  scaffolderListTaskRouteRef,\n  scaffolderTaskRouteRef,\n  selectedTemplateRouteRef,\n  templateFormRouteRef,\n} from '../../routes';\nimport { ErrorPage } from '@backstage/core-components';\n\nimport { ActionsPage } from '../../components/ActionsPage';\nimport { ListTasksPage } from '../../components/ListTasksPage';\n\nimport {\n  TemplateListPageProps,\n  TemplateWizardPageProps,\n} from '@backstage/plugin-scaffolder/alpha';\nimport { TemplateListPage, TemplateWizardPage } from '../../alpha/components';\nimport { OngoingTask } from '../OngoingTask';\nimport {\n  TemplateFormPage,\n  TemplateIntroPage,\n  TemplateEditorPage,\n  CustomFieldsPage,\n} from '../../alpha/components/TemplateEditorPage';\nimport { RequirePermission } from '@backstage/plugin-permission-react';\nimport {\n  taskReadPermission,\n  templateManagementPermission,\n} from '@backstage/plugin-scaffolder-common/alpha';\n\n/**\n * The Props for the Scaffolder Router\n *\n * @public\n */\nexport type RouterProps = {\n  components?: {\n    ReviewStepComponent?: React.ComponentType<ReviewStepProps>;\n    TemplateCardComponent?: React.ComponentType<{\n      template: TemplateEntityV1beta3;\n    }>;\n    TaskPageComponent?: React.ComponentType<PropsWithChildren<{}>>;\n    EXPERIMENTAL_TemplateOutputsComponent?: React.ComponentType<{\n      output?: ScaffolderTaskOutput;\n    }>;\n    EXPERIMENTAL_TemplateListPageComponent?: React.ComponentType<TemplateListPageProps>;\n    EXPERIMENTAL_TemplateWizardPageComponent?: React.ComponentType<TemplateWizardPageProps>;\n  };\n  groups?: TemplateGroupFilter[];\n  templateFilter?: (entity: TemplateEntityV1beta3) => boolean;\n  headerOptions?: {\n    pageTitleOverride?: string;\n    title?: string;\n    subtitle?: string;\n  };\n  defaultPreviewTemplate?: string;\n  formProps?: FormProps;\n  contextMenu?: {\n    /** Whether to show a link to the template editor */\n    editor?: boolean;\n    /** Whether to show a link to the actions documentation */\n    actions?: boolean;\n    /** Whether to show a link to the tasks page */\n    tasks?: boolean;\n    /** Whether to show a link to the create page (on /create subroutes) */\n    create?: boolean;\n  };\n};\n\n/**\n * The Scaffolder Router\n *\n * @public\n */\nexport const Router = (props: PropsWithChildren<RouterProps>) => {\n  const {\n    components: {\n      TemplateCardComponent,\n      TaskPageComponent = OngoingTask,\n      ReviewStepComponent,\n      EXPERIMENTAL_TemplateOutputsComponent: TemplateOutputsComponent,\n      EXPERIMENTAL_TemplateListPageComponent:\n        TemplateListPageComponent = TemplateListPage,\n      EXPERIMENTAL_TemplateWizardPageComponent:\n        TemplateWizardPageComponent = TemplateWizardPage,\n    } = {},\n  } = props;\n  const outlet = useOutlet() || props.children;\n  const customFieldExtensions =\n    useCustomFieldExtensions<FieldExtensionOptions>(outlet);\n\n  const fieldExtensions = [\n    ...customFieldExtensions,\n    ...DEFAULT_SCAFFOLDER_FIELD_EXTENSIONS.filter(\n      ({ name }) =>\n        !customFieldExtensions.some(\n          customFieldExtension => customFieldExtension.name === name,\n        ),\n    ),\n  ] as FieldExtensionOptions[];\n\n  const customLayouts = useCustomLayouts(outlet);\n\n  return (\n    <Routes>\n      <Route\n        path=\"/\"\n        element={\n          <TemplateListPageComponent\n            TemplateCardComponent={TemplateCardComponent}\n            contextMenu={props.contextMenu}\n            groups={props.groups}\n            templateFilter={props.templateFilter}\n            headerOptions={props.headerOptions}\n          />\n        }\n      />\n      <Route\n        path={selectedTemplateRouteRef.path}\n        element={\n          <SecretsContextProvider>\n            <TemplateWizardPageComponent\n              headerOptions={props.headerOptions}\n              customFieldExtensions={fieldExtensions}\n              layouts={customLayouts}\n              components={{ ReviewStepComponent }}\n              formProps={props.formProps}\n            />\n          </SecretsContextProvider>\n        }\n      />\n      <Route\n        path={scaffolderTaskRouteRef.path}\n        element={\n          <RequirePermission permission={taskReadPermission}>\n            <TaskPageComponent\n              TemplateOutputsComponent={TemplateOutputsComponent}\n            />\n          </RequirePermission>\n        }\n      />\n      <Route\n        path={editRouteRef.path}\n        element={\n          <RequirePermission permission={templateManagementPermission}>\n            <SecretsContextProvider>\n              <TemplateIntroPage />\n            </SecretsContextProvider>\n          </RequirePermission>\n        }\n      />\n      <Route\n        path={customFieldsRouteRef.path}\n        element={\n          <RequirePermission permission={templateManagementPermission}>\n            <SecretsContextProvider>\n              <CustomFieldsPage fieldExtensions={fieldExtensions} />\n            </SecretsContextProvider>\n          </RequirePermission>\n        }\n      />\n      <Route\n        path={templateFormRouteRef.path}\n        element={\n          <RequirePermission permission={templateManagementPermission}>\n            <SecretsContextProvider>\n              <TemplateFormPage\n                layouts={customLayouts}\n                formProps={props.formProps}\n                fieldExtensions={fieldExtensions}\n              />\n            </SecretsContextProvider>\n          </RequirePermission>\n        }\n      />\n\n      <Route\n        path={actionsRouteRef.path}\n        element={<ActionsPage contextMenu={props.contextMenu} />}\n      />\n      <Route\n        path={scaffolderListTaskRouteRef.path}\n        element={\n          <RequirePermission permission={taskReadPermission}>\n            <ListTasksPage contextMenu={props.contextMenu} />\n          </RequirePermission>\n        }\n      />\n      <Route\n        path={editorRouteRef.path}\n        element={\n          <RequirePermission permission={templateManagementPermission}>\n            <SecretsContextProvider>\n              <TemplateEditorPage\n                layouts={customLayouts}\n                formProps={props.formProps}\n                fieldExtensions={fieldExtensions}\n              />\n            </SecretsContextProvider>\n          </RequirePermission>\n        }\n      />\n      <Route\n        path=\"*\"\n        element={<ErrorPage status=\"404\" statusMessage=\"Page not found\" />}\n      />\n    </Routes>\n  );\n};\n"],"names":[],"mappings":"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"}