{"version":3,"file":"useSignal.esm.js","sources":["../../src/hooks/useSignal.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { signalApiRef } from '../api';\nimport { useApiHolder } from '@backstage/core-plugin-api';\nimport { JsonObject } from '@backstage/types';\nimport { useEffect, useMemo, useState } from 'react';\n\n/** @public */\nexport const useSignal = <TMessage extends JsonObject = JsonObject>(\n  channel: string,\n): { lastSignal: TMessage | null; isSignalsAvailable: boolean } => {\n  const apiHolder = useApiHolder();\n  // Use apiHolder instead useApi in case signalApi is not available in the\n  // backstage instance this is used\n  const signals = apiHolder.get(signalApiRef);\n  const [lastSignal, setLastSignal] = useState<TMessage | null>(null);\n  useEffect(() => {\n    let unsub: null | (() => void) = null;\n    if (signals) {\n      const { unsubscribe } = signals.subscribe<TMessage>(\n        channel,\n        (msg: TMessage) => {\n          setLastSignal(msg);\n        },\n      );\n      unsub = unsubscribe;\n    }\n    return () => {\n      if (signals && unsub) {\n        unsub();\n      }\n    };\n  }, [signals, channel]);\n\n  // Can be used to fallback (for example to long polling) if signals are not available in the system\n  const isSignalsAvailable = useMemo(() => !!signals, [signals]);\n\n  return { lastSignal, isSignalsAvailable };\n};\n"],"names":[],"mappings":";;;;AAqBa,MAAA,SAAA,GAAY,CACvB,OACiE,KAAA;AACjE,EAAA,MAAM,YAAY,YAAa,EAAA;AAG/B,EAAM,MAAA,OAAA,GAAU,SAAU,CAAA,GAAA,CAAI,YAAY,CAAA;AAC1C,EAAA,MAAM,CAAC,UAAA,EAAY,aAAa,CAAA,GAAI,SAA0B,IAAI,CAAA;AAClE,EAAA,SAAA,CAAU,MAAM;AACd,IAAA,IAAI,KAA6B,GAAA,IAAA;AACjC,IAAA,IAAI,OAAS,EAAA;AACX,MAAM,MAAA,EAAE,WAAY,EAAA,GAAI,OAAQ,CAAA,SAAA;AAAA,QAC9B,OAAA;AAAA,QACA,CAAC,GAAkB,KAAA;AACjB,UAAA,aAAA,CAAc,GAAG,CAAA;AAAA;AACnB,OACF;AACA,MAAQ,KAAA,GAAA,WAAA;AAAA;AAEV,IAAA,OAAO,MAAM;AACX,MAAA,IAAI,WAAW,KAAO,EAAA;AACpB,QAAM,KAAA,EAAA;AAAA;AACR,KACF;AAAA,GACC,EAAA,CAAC,OAAS,EAAA,OAAO,CAAC,CAAA;AAGrB,EAAM,MAAA,kBAAA,GAAqB,QAAQ,MAAM,CAAC,CAAC,OAAS,EAAA,CAAC,OAAO,CAAC,CAAA;AAE7D,EAAO,OAAA,EAAE,YAAY,kBAAmB,EAAA;AAC1C;;;;"}