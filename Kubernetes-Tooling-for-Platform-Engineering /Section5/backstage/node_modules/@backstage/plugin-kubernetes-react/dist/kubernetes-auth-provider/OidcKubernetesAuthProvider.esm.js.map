{"version":3,"file":"OidcKubernetesAuthProvider.esm.js","sources":["../../src/kubernetes-auth-provider/OidcKubernetesAuthProvider.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { JsonObject } from '@backstage/types';\nimport { KubernetesRequestBody } from '@backstage/plugin-kubernetes-common';\nimport { OpenIdConnectApi } from '@backstage/core-plugin-api';\nimport { KubernetesAuthProvider } from './types';\n\n/** @public */\nexport class OidcKubernetesAuthProvider implements KubernetesAuthProvider {\n  providerName: string;\n  authProvider: OpenIdConnectApi;\n\n  constructor(providerName: string, authProvider: OpenIdConnectApi) {\n    this.providerName = providerName;\n    this.authProvider = authProvider;\n  }\n\n  async decorateRequestBodyForAuth(\n    requestBody: KubernetesRequestBody,\n  ): Promise<KubernetesRequestBody> {\n    const authToken: string = (await this.getCredentials()).token;\n    const auth = { ...(requestBody.auth as JsonObject) };\n    if (auth.oidc) {\n      (auth.oidc as JsonObject)[this.providerName] = authToken;\n    } else {\n      auth.oidc = { [this.providerName]: authToken };\n    }\n    requestBody.auth = auth;\n    return requestBody;\n  }\n\n  async getCredentials(): Promise<{ token: string }> {\n    return {\n      token: await this.authProvider.getIdToken(),\n    };\n  }\n}\n"],"names":[],"mappings":"AAsBO,MAAM,0BAA6D,CAAA;AAAA,EACxE,YAAA;AAAA,EACA,YAAA;AAAA,EAEA,WAAA,CAAY,cAAsB,YAAgC,EAAA;AAChE,IAAA,IAAA,CAAK,YAAe,GAAA,YAAA;AACpB,IAAA,IAAA,CAAK,YAAe,GAAA,YAAA;AAAA;AACtB,EAEA,MAAM,2BACJ,WACgC,EAAA;AAChC,IAAA,MAAM,SAAqB,GAAA,CAAA,MAAM,IAAK,CAAA,cAAA,EAAkB,EAAA,KAAA;AACxD,IAAA,MAAM,IAAO,GAAA,EAAE,GAAI,WAAA,CAAY,IAAoB,EAAA;AACnD,IAAA,IAAI,KAAK,IAAM,EAAA;AACb,MAAC,IAAK,CAAA,IAAA,CAAoB,IAAK,CAAA,YAAY,CAAI,GAAA,SAAA;AAAA,KAC1C,MAAA;AACL,MAAA,IAAA,CAAK,OAAO,EAAE,CAAC,IAAK,CAAA,YAAY,GAAG,SAAU,EAAA;AAAA;AAE/C,IAAA,WAAA,CAAY,IAAO,GAAA,IAAA;AACnB,IAAO,OAAA,WAAA;AAAA;AACT,EAEA,MAAM,cAA6C,GAAA;AACjD,IAAO,OAAA;AAAA,MACL,KAAO,EAAA,MAAM,IAAK,CAAA,YAAA,CAAa,UAAW;AAAA,KAC5C;AAAA;AAEJ;;;;"}