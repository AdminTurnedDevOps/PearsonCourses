{"version":3,"file":"StepsProgress.esm.js","sources":["../../../../src/components/CustomResources/ArgoRollouts/StepsProgress.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport Step from '@material-ui/core/Step';\nimport StepLabel from '@material-ui/core/StepLabel';\nimport Stepper from '@material-ui/core/Stepper';\nimport Typography from '@material-ui/core/Typography';\nimport {\n  ArgoRolloutCanaryStep,\n  SetWeightStep,\n  PauseStep,\n  AnalysisStep,\n} from './types';\n\ninterface StepsProgressProps {\n  currentStepIndex: number;\n  aborted: boolean;\n  steps: ArgoRolloutCanaryStep[];\n  children?: React.ReactNode;\n}\n\nconst isSetWeightStep = (step: ArgoRolloutCanaryStep): step is SetWeightStep =>\n  step.hasOwnProperty('setWeight');\n\nconst isPauseStep = (step: ArgoRolloutCanaryStep): step is PauseStep =>\n  step.hasOwnProperty('pause');\n\nconst isAnalysisStep = (step: ArgoRolloutCanaryStep): step is AnalysisStep =>\n  step.hasOwnProperty('analysis');\n\nconst createLabelForStep = (step: ArgoRolloutCanaryStep): React.ReactNode => {\n  if (isSetWeightStep(step)) {\n    return `setWeight ${step.setWeight}%`;\n  } else if (isPauseStep(step)) {\n    return step.pause.duration === undefined\n      ? 'infinite pause'\n      : `pause for ${step.pause.duration}`;\n  } else if (isAnalysisStep(step)) {\n    return (\n      <div>\n        <Typography paragraph>analysis templates:</Typography>\n        {step.analysis.templates.map((t, i) => (\n          <Typography paragraph key={i}>{`${t.templateName}${\n            t.clusterScope ? ' (cluster scoped)' : ''\n          }`}</Typography>\n        ))}\n      </div>\n    );\n  }\n  return 'unknown step';\n};\n\nexport const StepsProgress = ({\n  currentStepIndex,\n  aborted,\n  steps,\n}: StepsProgressProps) => {\n  // If the activeStep is greater/equal to the number of steps\n  // Then the canary is being promoted\n  // Increase the step index to mark the 'canary promoted' step as done also\n  const activeStepIndex =\n    currentStepIndex >= steps.length ? currentStepIndex + 1 : currentStepIndex;\n\n  /*\n   *  When the Rollout is aborted set the active step to -1\n   *  otherwise it appears to always be on the first step\n   */\n  return (\n    <Stepper activeStep={aborted ? -1 : activeStepIndex} alternativeLabel>\n      {steps\n        .map((step, i) => (\n          <Step key={i}>\n            <StepLabel data-testid={`step-${i}`}>\n              {createLabelForStep(step)}\n            </StepLabel>\n          </Step>\n        ))\n        .concat(\n          <Step key=\"-1\">\n            <StepLabel data-testid=\"step--1\">Canary promoted</StepLabel>\n          </Step>,\n        )}\n    </Stepper>\n  );\n};\n"],"names":["React"],"mappings":";;;;;;AAmCA,MAAM,eAAkB,GAAA,CAAC,IACvB,KAAA,IAAA,CAAK,eAAe,WAAW,CAAA;AAEjC,MAAM,WAAc,GAAA,CAAC,IACnB,KAAA,IAAA,CAAK,eAAe,OAAO,CAAA;AAE7B,MAAM,cAAiB,GAAA,CAAC,IACtB,KAAA,IAAA,CAAK,eAAe,UAAU,CAAA;AAEhC,MAAM,kBAAA,GAAqB,CAAC,IAAiD,KAAA;AAC3E,EAAI,IAAA,eAAA,CAAgB,IAAI,CAAG,EAAA;AACzB,IAAO,OAAA,CAAA,UAAA,EAAa,KAAK,SAAS,CAAA,CAAA,CAAA;AAAA,GACpC,MAAA,IAAW,WAAY,CAAA,IAAI,CAAG,EAAA;AAC5B,IAAO,OAAA,IAAA,CAAK,MAAM,QAAa,KAAA,KAAA,CAAA,GAC3B,mBACA,CAAa,UAAA,EAAA,IAAA,CAAK,MAAM,QAAQ,CAAA,CAAA;AAAA,GACtC,MAAA,IAAW,cAAe,CAAA,IAAI,CAAG,EAAA;AAC/B,IAAA,uBACGA,cAAA,CAAA,aAAA,CAAA,KAAA,EAAA,IAAA,kBACEA,cAAA,CAAA,aAAA,CAAA,UAAA,EAAA,EAAW,SAAS,EAAA,IAAA,EAAA,EAAC,qBAAmB,CAAA,EACxC,IAAK,CAAA,QAAA,CAAS,SAAU,CAAA,GAAA,CAAI,CAAC,CAAG,EAAA,CAAA,qBAC9BA,cAAA,CAAA,aAAA,CAAA,UAAA,EAAA,EAAW,SAAS,EAAA,IAAA,EAAC,GAAK,EAAA,CAAA,EAAA,EAAI,GAAG,CAAE,CAAA,YAAY,CAC9C,EAAA,CAAA,CAAE,YAAe,GAAA,mBAAA,GAAsB,EACzC,CAAA,CAAG,CACJ,CACH,CAAA;AAAA;AAGJ,EAAO,OAAA,cAAA;AACT,CAAA;AAEO,MAAM,gBAAgB,CAAC;AAAA,EAC5B,gBAAA;AAAA,EACA,OAAA;AAAA,EACA;AACF,CAA0B,KAAA;AAIxB,EAAA,MAAM,eACJ,GAAA,gBAAA,IAAoB,KAAM,CAAA,MAAA,GAAS,mBAAmB,CAAI,GAAA,gBAAA;AAM5D,EAAA,uBACGA,cAAA,CAAA,aAAA,CAAA,OAAA,EAAA,EAAQ,UAAY,EAAA,OAAA,GAAU,CAAK,CAAA,GAAA,eAAA,EAAiB,gBAAgB,EAAA,IAAA,EAAA,EAClE,KACE,CAAA,GAAA,CAAI,CAAC,IAAA,EAAM,CACV,qBAAAA,cAAA,CAAA,aAAA,CAAC,IAAK,EAAA,EAAA,GAAA,EAAK,CACT,EAAA,kBAAAA,cAAA,CAAA,aAAA,CAAC,SAAU,EAAA,EAAA,aAAA,EAAa,CAAQ,KAAA,EAAA,CAAC,CAC9B,CAAA,EAAA,EAAA,kBAAA,CAAmB,IAAI,CAC1B,CACF,CACD,CACA,CAAA,MAAA;AAAA,oBACCA,cAAA,CAAA,aAAA,CAAC,QAAK,GAAI,EAAA,IAAA,EAAA,+CACP,SAAU,EAAA,EAAA,aAAA,EAAY,SAAU,EAAA,EAAA,iBAAe,CAClD;AAAA,GAEN,CAAA;AAEJ;;;;"}