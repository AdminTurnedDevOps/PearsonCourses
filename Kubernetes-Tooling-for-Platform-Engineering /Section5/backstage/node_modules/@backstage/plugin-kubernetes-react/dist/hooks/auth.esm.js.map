{"version":3,"file":"auth.esm.js","sources":["../../src/hooks/auth.ts"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { KubernetesRequestBody } from '@backstage/plugin-kubernetes-common';\nimport { KubernetesAuthProvidersApi } from '../kubernetes-auth-provider';\nimport { KubernetesApi } from '../api/types';\n\nexport const generateAuth = async (\n  entity: Entity,\n  kubernetesApi: KubernetesApi,\n  kubernetesAuthProvidersApi: KubernetesAuthProvidersApi,\n) => {\n  const clusters = await kubernetesApi.getClusters();\n\n  const authProviders: string[] = [\n    ...new Set(\n      clusters.map(\n        c =>\n          `${c.authProvider}${\n            c.oidcTokenProvider ? `.${c.oidcTokenProvider}` : ''\n          }`,\n      ),\n    ),\n  ];\n\n  let requestBody: KubernetesRequestBody = {\n    entity,\n  };\n  for (const authProviderStr of authProviders) {\n    requestBody = await kubernetesAuthProvidersApi.decorateRequestBodyForAuth(\n      authProviderStr,\n      requestBody,\n    );\n  }\n  return requestBody.auth ?? {};\n};\n"],"names":[],"mappings":"AAqBO,MAAM,YAAe,GAAA,OAC1B,MACA,EAAA,aAAA,EACA,0BACG,KAAA;AACH,EAAM,MAAA,QAAA,GAAW,MAAM,aAAA,CAAc,WAAY,EAAA;AAEjD,EAAA,MAAM,aAA0B,GAAA;AAAA,IAC9B,GAAG,IAAI,GAAA;AAAA,MACL,QAAS,CAAA,GAAA;AAAA,QACP,CAAA,CAAA,KACE,CAAG,EAAA,CAAA,CAAE,YAAY,CAAA,EACf,CAAE,CAAA,iBAAA,GAAoB,CAAI,CAAA,EAAA,CAAA,CAAE,iBAAiB,CAAA,CAAA,GAAK,EACpD,CAAA;AAAA;AACJ;AACF,GACF;AAEA,EAAA,IAAI,WAAqC,GAAA;AAAA,IACvC;AAAA,GACF;AACA,EAAA,KAAA,MAAW,mBAAmB,aAAe,EAAA;AAC3C,IAAA,WAAA,GAAc,MAAM,0BAA2B,CAAA,0BAAA;AAAA,MAC7C,eAAA;AAAA,MACA;AAAA,KACF;AAAA;AAEF,EAAO,OAAA,WAAA,CAAY,QAAQ,EAAC;AAC9B;;;;"}