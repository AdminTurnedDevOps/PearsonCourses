{"version":3,"file":"module.cjs.js","sources":["../src/module.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  coreServices,\n  createBackendModule,\n} from '@backstage/backend-plugin-api';\nimport { searchEngineRegistryExtensionPoint } from '@backstage/plugin-search-backend-node/alpha';\nimport { PgSearchEngine } from './PgSearchEngine';\n\n/**\n * @public\n * Search backend module for the Postgres engine.\n */\nexport default createBackendModule({\n  pluginId: 'search',\n  moduleId: 'postgres-engine',\n  register(env) {\n    env.registerInit({\n      deps: {\n        searchEngineRegistry: searchEngineRegistryExtensionPoint,\n        database: coreServices.database,\n        config: coreServices.rootConfig,\n        logger: coreServices.logger,\n      },\n      async init({ searchEngineRegistry, database, config, logger }) {\n        if (await PgSearchEngine.supported(database)) {\n          searchEngineRegistry.setSearchEngine(\n            await PgSearchEngine.fromConfig(config, {\n              database,\n              logger,\n            }),\n          );\n        } else {\n          logger.warn(\n            'Postgres search engine is not supported, skipping registration of search-backend-module-pg',\n          );\n        }\n      },\n    });\n  },\n});\n"],"names":["createBackendModule","searchEngineRegistryExtensionPoint","coreServices","PgSearchEngine"],"mappings":";;;;;;;;AA0BA,cAAeA,oCAAoB,CAAA;AAAA,EACjC,QAAU,EAAA,QAAA;AAAA,EACV,QAAU,EAAA,iBAAA;AAAA,EACV,SAAS,GAAK,EAAA;AACZ,IAAA,GAAA,CAAI,YAAa,CAAA;AAAA,MACf,IAAM,EAAA;AAAA,QACJ,oBAAsB,EAAAC,wCAAA;AAAA,QACtB,UAAUC,6BAAa,CAAA,QAAA;AAAA,QACvB,QAAQA,6BAAa,CAAA,UAAA;AAAA,QACrB,QAAQA,6BAAa,CAAA;AAAA,OACvB;AAAA,MACA,MAAM,IAAK,CAAA,EAAE,sBAAsB,QAAU,EAAA,MAAA,EAAQ,QAAU,EAAA;AAC7D,QAAA,IAAI,MAAMC,6BAAA,CAAe,SAAU,CAAA,QAAQ,CAAG,EAAA;AAC5C,UAAqB,oBAAA,CAAA,eAAA;AAAA,YACnB,MAAMA,6BAAe,CAAA,UAAA,CAAW,MAAQ,EAAA;AAAA,cACtC,QAAA;AAAA,cACA;AAAA,aACD;AAAA,WACH;AAAA,SACK,MAAA;AACL,UAAO,MAAA,CAAA,IAAA;AAAA,YACL;AAAA,WACF;AAAA;AACF;AACF,KACD,CAAA;AAAA;AAEL,CAAC,CAAA;;;;"}