{"version":3,"file":"validation.esm.js","sources":["../../src/routing/validation.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BackstagePlugin,\n  ExternalRouteRef,\n  RouteRef,\n  SubRouteRef,\n} from '@backstage/core-plugin-api';\nimport { joinPaths } from './helpers';\nimport { AnyRouteRef } from './types';\n\n// Validates that there is no duplication of route parameter names\nexport function validateRouteParameters(\n  routePaths: Map<AnyRouteRef, string>,\n  routeParents: Map<AnyRouteRef, AnyRouteRef | undefined>,\n) {\n  const notLeafRoutes = new Set(routeParents.values());\n  notLeafRoutes.delete(undefined);\n\n  for (const route of routeParents.keys()) {\n    if (notLeafRoutes.has(route)) {\n      continue;\n    }\n\n    let currentRouteRef: AnyRouteRef | undefined = route;\n\n    let fullPath = '';\n    while (currentRouteRef) {\n      const path = routePaths.get(currentRouteRef);\n      if (path === undefined) {\n        throw new Error(`No path for ${currentRouteRef}`);\n      }\n      fullPath = joinPaths(path, fullPath);\n      currentRouteRef = routeParents.get(currentRouteRef);\n    }\n\n    const params = fullPath.match(/:(\\w+)/g);\n    if (params) {\n      for (let j = 0; j < params.length; j++) {\n        for (let i = j + 1; i < params.length; i++) {\n          if (params[i] === params[j]) {\n            throw new Error(\n              `Parameter ${params[i]} is duplicated in path ${fullPath}`,\n            );\n          }\n        }\n      }\n    }\n  }\n}\n\n// Validates that all non-optional external routes have been bound\nexport function validateRouteBindings(\n  routeBindings: Map<ExternalRouteRef, RouteRef | SubRouteRef>,\n  plugins: Iterable<\n    Pick<\n      BackstagePlugin<{}, Record<string, ExternalRouteRef>>,\n      'getId' | 'externalRoutes'\n    >\n  >,\n) {\n  for (const plugin of plugins) {\n    if (!plugin.externalRoutes) {\n      continue;\n    }\n\n    for (const [name, externalRouteRef] of Object.entries(\n      plugin.externalRoutes,\n    )) {\n      if (externalRouteRef.optional) {\n        continue;\n      }\n\n      if (!routeBindings.has(externalRouteRef)) {\n        throw new Error(\n          `External route '${name}' of the '${plugin.getId()}' plugin must be bound to a target route. ` +\n            'See https://backstage.io/link?bind-routes for details.',\n        );\n      }\n    }\n  }\n}\n"],"names":[],"mappings":";;AA0BgB,SAAA,uBAAA,CACd,YACA,YACA,EAAA;AACA,EAAA,MAAM,aAAgB,GAAA,IAAI,GAAI,CAAA,YAAA,CAAa,QAAQ,CAAA;AACnD,EAAA,aAAA,CAAc,OAAO,KAAS,CAAA,CAAA;AAE9B,EAAW,KAAA,MAAA,KAAA,IAAS,YAAa,CAAA,IAAA,EAAQ,EAAA;AACvC,IAAI,IAAA,aAAA,CAAc,GAAI,CAAA,KAAK,CAAG,EAAA;AAC5B,MAAA;AAAA;AAGF,IAAA,IAAI,eAA2C,GAAA,KAAA;AAE/C,IAAA,IAAI,QAAW,GAAA,EAAA;AACf,IAAA,OAAO,eAAiB,EAAA;AACtB,MAAM,MAAA,IAAA,GAAO,UAAW,CAAA,GAAA,CAAI,eAAe,CAAA;AAC3C,MAAA,IAAI,SAAS,KAAW,CAAA,EAAA;AACtB,QAAA,MAAM,IAAI,KAAA,CAAM,CAAe,YAAA,EAAA,eAAe,CAAE,CAAA,CAAA;AAAA;AAElD,MAAW,QAAA,GAAA,SAAA,CAAU,MAAM,QAAQ,CAAA;AACnC,MAAkB,eAAA,GAAA,YAAA,CAAa,IAAI,eAAe,CAAA;AAAA;AAGpD,IAAM,MAAA,MAAA,GAAS,QAAS,CAAA,KAAA,CAAM,SAAS,CAAA;AACvC,IAAA,IAAI,MAAQ,EAAA;AACV,MAAA,KAAA,IAAS,CAAI,GAAA,CAAA,EAAG,CAAI,GAAA,MAAA,CAAO,QAAQ,CAAK,EAAA,EAAA;AACtC,QAAA,KAAA,IAAS,IAAI,CAAI,GAAA,CAAA,EAAG,CAAI,GAAA,MAAA,CAAO,QAAQ,CAAK,EAAA,EAAA;AAC1C,UAAA,IAAI,MAAO,CAAA,CAAC,CAAM,KAAA,MAAA,CAAO,CAAC,CAAG,EAAA;AAC3B,YAAA,MAAM,IAAI,KAAA;AAAA,cACR,CAAa,UAAA,EAAA,MAAA,CAAO,CAAC,CAAC,0BAA0B,QAAQ,CAAA;AAAA,aAC1D;AAAA;AACF;AACF;AACF;AACF;AAEJ;AAGgB,SAAA,qBAAA,CACd,eACA,OAMA,EAAA;AACA,EAAA,KAAA,MAAW,UAAU,OAAS,EAAA;AAC5B,IAAI,IAAA,CAAC,OAAO,cAAgB,EAAA;AAC1B,MAAA;AAAA;AAGF,IAAA,KAAA,MAAW,CAAC,IAAA,EAAM,gBAAgB,CAAA,IAAK,MAAO,CAAA,OAAA;AAAA,MAC5C,MAAO,CAAA;AAAA,KACN,EAAA;AACD,MAAA,IAAI,iBAAiB,QAAU,EAAA;AAC7B,QAAA;AAAA;AAGF,MAAA,IAAI,CAAC,aAAA,CAAc,GAAI,CAAA,gBAAgB,CAAG,EAAA;AACxC,QAAA,MAAM,IAAI,KAAA;AAAA,UACR,CAAmB,gBAAA,EAAA,IAAI,CAAa,UAAA,EAAA,MAAA,CAAO,OAAO,CAAA,gGAAA;AAAA,SAEpD;AAAA;AACF;AACF;AAEJ;;;;"}