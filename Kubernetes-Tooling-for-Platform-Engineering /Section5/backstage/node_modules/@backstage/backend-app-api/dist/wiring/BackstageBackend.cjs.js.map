{"version":3,"file":"BackstageBackend.cjs.js","sources":["../../src/wiring/BackstageBackend.ts"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BackendFeature, ServiceFactory } from '@backstage/backend-plugin-api';\nimport { BackendInitializer } from './BackendInitializer';\nimport { unwrapFeature } from './helpers';\nimport { Backend } from './types';\n\nexport class BackstageBackend implements Backend {\n  #initializer: BackendInitializer;\n\n  constructor(defaultServiceFactories: ServiceFactory[]) {\n    this.#initializer = new BackendInitializer(defaultServiceFactories);\n  }\n\n  add(feature: BackendFeature | Promise<{ default: BackendFeature }>): void {\n    if (isPromise(feature)) {\n      this.#initializer.add(feature.then(f => unwrapFeature(f.default)));\n    } else {\n      this.#initializer.add(unwrapFeature(feature));\n    }\n  }\n\n  async start(): Promise<void> {\n    await this.#initializer.start();\n  }\n\n  async stop(): Promise<void> {\n    await this.#initializer.stop();\n  }\n}\n\nfunction isPromise<T>(value: unknown | Promise<T>): value is Promise<T> {\n  return (\n    typeof value === 'object' &&\n    value !== null &&\n    'then' in value &&\n    typeof value.then === 'function'\n  );\n}\n"],"names":["BackendInitializer","unwrapFeature"],"mappings":";;;;;AAqBO,MAAM,gBAAoC,CAAA;AAAA,EAC/C,YAAA;AAAA,EAEA,YAAY,uBAA2C,EAAA;AACrD,IAAK,IAAA,CAAA,YAAA,GAAe,IAAIA,qCAAA,CAAmB,uBAAuB,CAAA;AAAA;AACpE,EAEA,IAAI,OAAsE,EAAA;AACxE,IAAI,IAAA,SAAA,CAAU,OAAO,CAAG,EAAA;AACtB,MAAK,IAAA,CAAA,YAAA,CAAa,IAAI,OAAQ,CAAA,IAAA,CAAK,OAAKC,qBAAc,CAAA,CAAA,CAAE,OAAO,CAAC,CAAC,CAAA;AAAA,KAC5D,MAAA;AACL,MAAA,IAAA,CAAK,YAAa,CAAA,GAAA,CAAIA,qBAAc,CAAA,OAAO,CAAC,CAAA;AAAA;AAC9C;AACF,EAEA,MAAM,KAAuB,GAAA;AAC3B,IAAM,MAAA,IAAA,CAAK,aAAa,KAAM,EAAA;AAAA;AAChC,EAEA,MAAM,IAAsB,GAAA;AAC1B,IAAM,MAAA,IAAA,CAAK,aAAa,IAAK,EAAA;AAAA;AAEjC;AAEA,SAAS,UAAa,KAAkD,EAAA;AACtE,EACE,OAAA,OAAO,UAAU,QACjB,IAAA,KAAA,KAAU,QACV,MAAU,IAAA,KAAA,IACV,OAAO,KAAA,CAAM,IAAS,KAAA,UAAA;AAE1B;;;;"}