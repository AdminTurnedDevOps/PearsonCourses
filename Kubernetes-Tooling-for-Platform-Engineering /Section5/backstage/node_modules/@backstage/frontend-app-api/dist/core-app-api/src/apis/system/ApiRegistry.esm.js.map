{"version":3,"file":"ApiRegistry.esm.js","sources":["../../../../../../core-app-api/src/apis/system/ApiRegistry.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ApiRef, ApiHolder } from '@backstage/core-plugin-api';\n\ntype ApiImpl<T = unknown> = readonly [ApiRef<T>, T];\n\n/** @internal */\nclass ApiRegistryBuilder {\n  private apis: [string, unknown][] = [];\n\n  add<T, I extends T>(api: ApiRef<T>, impl: I): I {\n    this.apis.push([api.id, impl]);\n    return impl;\n  }\n\n  build(): ApiRegistry {\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    return new ApiRegistry(new Map(this.apis));\n  }\n}\n\n/**\n * A registry for utility APIs.\n *\n * @internal\n */\nexport class ApiRegistry implements ApiHolder {\n  static builder() {\n    return new ApiRegistryBuilder();\n  }\n\n  /**\n   * Creates a new ApiRegistry with a list of API implementations.\n   *\n   * @param apis - A list of pairs mapping an ApiRef to its respective implementation\n   */\n  static from(apis: ApiImpl[]) {\n    return new ApiRegistry(new Map(apis.map(([api, impl]) => [api.id, impl])));\n  }\n\n  /**\n   * Creates a new ApiRegistry with a single API implementation.\n   *\n   * @param api - ApiRef for the API to add\n   * @param impl - Implementation of the API to add\n   */\n  static with<T>(api: ApiRef<T>, impl: T): ApiRegistry {\n    return new ApiRegistry(new Map([[api.id, impl]]));\n  }\n\n  constructor(private readonly apis: Map<string, unknown>) {}\n\n  /**\n   * Returns a new ApiRegistry with the provided API added to the existing ones.\n   *\n   * @param api - ApiRef for the API to add\n   * @param impl - Implementation of the API to add\n   */\n  with<T>(api: ApiRef<T>, impl: T): ApiRegistry {\n    return new ApiRegistry(new Map([...this.apis, [api.id, impl]]));\n  }\n\n  get<T>(api: ApiRef<T>): T | undefined {\n    return this.apis.get(api.id) as T | undefined;\n  }\n}\n"],"names":[],"mappings":"AAqBA,MAAM,kBAAmB,CAAA;AAAA,EACf,OAA4B,EAAC;AAAA,EAErC,GAAA,CAAoB,KAAgB,IAAY,EAAA;AAC9C,IAAA,IAAA,CAAK,KAAK,IAAK,CAAA,CAAC,GAAI,CAAA,EAAA,EAAI,IAAI,CAAC,CAAA;AAC7B,IAAO,OAAA,IAAA;AAAA;AACT,EAEA,KAAqB,GAAA;AAEnB,IAAA,OAAO,IAAI,WAAY,CAAA,IAAI,GAAI,CAAA,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA;AAE7C;AAOO,MAAM,WAAiC,CAAA;AAAA,EAwB5C,YAA6B,IAA4B,EAAA;AAA5B,IAAA,IAAA,CAAA,IAAA,GAAA,IAAA;AAAA;AAA6B,EAvB1D,OAAO,OAAU,GAAA;AACf,IAAA,OAAO,IAAI,kBAAmB,EAAA;AAAA;AAChC;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,OAAO,KAAK,IAAiB,EAAA;AAC3B,IAAA,OAAO,IAAI,WAAY,CAAA,IAAI,GAAI,CAAA,IAAA,CAAK,IAAI,CAAC,CAAC,GAAK,EAAA,IAAI,MAAM,CAAC,GAAA,CAAI,IAAI,IAAI,CAAC,CAAC,CAAC,CAAA;AAAA;AAC3E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,OAAO,IAAQ,CAAA,GAAA,EAAgB,IAAsB,EAAA;AACnD,IAAO,OAAA,IAAI,WAAY,iBAAA,IAAI,GAAI,CAAA,CAAC,CAAC,GAAA,CAAI,EAAI,EAAA,IAAI,CAAC,CAAC,CAAC,CAAA;AAAA;AAClD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,IAAA,CAAQ,KAAgB,IAAsB,EAAA;AAC5C,IAAA,OAAO,IAAI,WAAA,CAAY,IAAI,GAAA,CAAI,CAAC,GAAG,IAAA,CAAK,IAAM,EAAA,CAAC,GAAI,CAAA,EAAA,EAAI,IAAI,CAAC,CAAC,CAAC,CAAA;AAAA;AAChE,EAEA,IAAO,GAA+B,EAAA;AACpC,IAAA,OAAO,IAAK,CAAA,IAAA,CAAK,GAAI,CAAA,GAAA,CAAI,EAAE,CAAA;AAAA;AAE/B;;;;"}