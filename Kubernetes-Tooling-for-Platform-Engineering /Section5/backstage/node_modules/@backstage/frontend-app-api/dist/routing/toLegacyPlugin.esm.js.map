{"version":3,"file":"toLegacyPlugin.esm.js","sources":["../../src/routing/toLegacyPlugin.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FrontendPlugin } from '@backstage/frontend-plugin-api';\nimport { BackstagePlugin as LegacyBackstagePlugin } from '@backstage/core-plugin-api';\nimport { getOrCreateGlobalSingleton } from '@backstage/version-bridge';\n\n// Make sure that we only convert each new plugin instance to its legacy equivalent once\nconst legacyPluginStore = getOrCreateGlobalSingleton(\n  'legacy-plugin-compatibility-store',\n  () => new WeakMap<FrontendPlugin, LegacyBackstagePlugin>(),\n);\n\nexport function toLegacyPlugin(plugin: FrontendPlugin): LegacyBackstagePlugin {\n  let legacy = legacyPluginStore.get(plugin);\n  if (legacy) {\n    return legacy;\n  }\n\n  const errorMsg = 'Not implemented in legacy plugin compatibility layer';\n  const notImplemented = () => {\n    throw new Error(errorMsg);\n  };\n\n  legacy = {\n    getId(): string {\n      return plugin.id;\n    },\n    get routes() {\n      return {};\n    },\n    get externalRoutes() {\n      return {};\n    },\n    getApis: notImplemented,\n    getFeatureFlags: notImplemented,\n    provide: notImplemented,\n  };\n\n  legacyPluginStore.set(plugin, legacy);\n  return legacy;\n}\n"],"names":[],"mappings":";;AAqBA,MAAM,iBAAoB,GAAA,0BAAA;AAAA,EACxB,mCAAA;AAAA,EACA,0BAAU,OAA+C;AAC3D,CAAA;AAEO,SAAS,eAAe,MAA+C,EAAA;AAC5E,EAAI,IAAA,MAAA,GAAS,iBAAkB,CAAA,GAAA,CAAI,MAAM,CAAA;AACzC,EAAA,IAAI,MAAQ,EAAA;AACV,IAAO,OAAA,MAAA;AAAA;AAGT,EAAA,MAAM,QAAW,GAAA,sDAAA;AACjB,EAAA,MAAM,iBAAiB,MAAM;AAC3B,IAAM,MAAA,IAAI,MAAM,QAAQ,CAAA;AAAA,GAC1B;AAEA,EAAS,MAAA,GAAA;AAAA,IACP,KAAgB,GAAA;AACd,MAAA,OAAO,MAAO,CAAA,EAAA;AAAA,KAChB;AAAA,IACA,IAAI,MAAS,GAAA;AACX,MAAA,OAAO,EAAC;AAAA,KACV;AAAA,IACA,IAAI,cAAiB,GAAA;AACnB,MAAA,OAAO,EAAC;AAAA,KACV;AAAA,IACA,OAAS,EAAA,cAAA;AAAA,IACT,eAAiB,EAAA,cAAA;AAAA,IACjB,OAAS,EAAA;AAAA,GACX;AAEA,EAAkB,iBAAA,CAAA,GAAA,CAAI,QAAQ,MAAM,CAAA;AACpC,EAAO,OAAA,MAAA;AACT;;;;"}