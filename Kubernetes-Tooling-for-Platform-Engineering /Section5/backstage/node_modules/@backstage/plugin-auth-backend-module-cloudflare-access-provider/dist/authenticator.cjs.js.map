{"version":3,"file":"authenticator.cjs.js","sources":["../src/authenticator.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CacheService } from '@backstage/backend-plugin-api';\nimport {\n  ProxyAuthenticator,\n  createProxyAuthenticator,\n} from '@backstage/plugin-auth-node';\nimport { AuthHelper } from './helpers';\nimport { CloudflareAccessResult } from './types';\n\n/**\n * Implements Cloudflare Access authentication.\n *\n * @public\n */\nexport function createCloudflareAccessAuthenticator(options?: {\n  cache?: CacheService;\n}): ProxyAuthenticator<\n  unknown,\n  CloudflareAccessResult,\n  CloudflareAccessResult\n> {\n  return createProxyAuthenticator({\n    async defaultProfileTransform(result: CloudflareAccessResult) {\n      return {\n        profile: {\n          email: result.claims.email,\n          displayName: result.cfIdentity.name,\n        },\n      };\n    },\n    initialize({ config }) {\n      return {\n        helper: AuthHelper.fromConfig(config, { cache: options?.cache }),\n      };\n    },\n    async authenticate({ req }, { helper }) {\n      const result = await helper.authenticate(req);\n      return {\n        result,\n        providerInfo: result,\n      };\n    },\n  });\n}\n"],"names":["createProxyAuthenticator","AuthHelper"],"mappings":";;;;;AA6BO,SAAS,oCAAoC,OAMlD,EAAA;AACA,EAAA,OAAOA,uCAAyB,CAAA;AAAA,IAC9B,MAAM,wBAAwB,MAAgC,EAAA;AAC5D,MAAO,OAAA;AAAA,QACL,OAAS,EAAA;AAAA,UACP,KAAA,EAAO,OAAO,MAAO,CAAA,KAAA;AAAA,UACrB,WAAA,EAAa,OAAO,UAAW,CAAA;AAAA;AACjC,OACF;AAAA,KACF;AAAA,IACA,UAAA,CAAW,EAAE,MAAA,EAAU,EAAA;AACrB,MAAO,OAAA;AAAA,QACL,MAAA,EAAQC,mBAAW,UAAW,CAAA,MAAA,EAAQ,EAAE,KAAO,EAAA,OAAA,EAAS,OAAO;AAAA,OACjE;AAAA,KACF;AAAA,IACA,MAAM,YAAa,CAAA,EAAE,KAAO,EAAA,EAAE,QAAU,EAAA;AACtC,MAAA,MAAM,MAAS,GAAA,MAAM,MAAO,CAAA,YAAA,CAAa,GAAG,CAAA;AAC5C,MAAO,OAAA;AAAA,QACL,MAAA;AAAA,QACA,YAAc,EAAA;AAAA,OAChB;AAAA;AACF,GACD,CAAA;AACH;;;;"}