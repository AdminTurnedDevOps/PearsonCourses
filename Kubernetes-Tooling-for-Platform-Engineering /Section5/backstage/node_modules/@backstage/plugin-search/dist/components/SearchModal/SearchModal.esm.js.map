{"version":3,"file":"SearchModal.esm.js","sources":["../../../src/components/SearchModal/SearchModal.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { useContent } from '@backstage/core-components';\nimport { useRouteRef } from '@backstage/core-plugin-api';\nimport {\n  SearchBar,\n  SearchContextProvider,\n  SearchResult,\n  SearchResultPager,\n} from '@backstage/plugin-search-react';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Divider from '@material-ui/core/Divider';\nimport Grid from '@material-ui/core/Grid';\nimport { useTheme } from '@material-ui/core/styles';\nimport Box from '@material-ui/core/Box';\nimport Button from '@material-ui/core/Button';\nimport IconButton from '@material-ui/core/IconButton';\nimport { makeStyles } from '@material-ui/core/styles';\nimport ArrowForwardIcon from '@material-ui/icons/ArrowForward';\nimport CloseIcon from '@material-ui/icons/Close';\nimport React, { ReactNode, useCallback, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\n\nimport { rootRouteRef } from '../../plugin';\nimport { SearchResultSet } from '@backstage/plugin-search-common';\n\n/**\n * @public\n */\nexport interface SearchModalChildrenProps {\n  /**\n   * A function that should be invoked when navigating away from the modal.\n   */\n  toggleModal: () => void;\n\n  /**\n   * Ability to provide custom components to render the result items\n   */\n  resultItemComponents?:\n    | ReactNode\n    | ((resultSet: SearchResultSet) => JSX.Element);\n}\n\n/**\n * @public\n */\nexport interface SearchModalProps {\n  /**\n   * If true, it renders the modal.\n   */\n  open?: boolean;\n  /**\n   * This is supposed to be used together with the open prop.\n   * If `hidden` is true, it hides the modal.\n   * If `open` is false, the value of `hidden` has no effect on the modal.\n   * Use `open` for controlling whether the modal should be rendered or not.\n   */\n  hidden?: boolean;\n  /**\n   * a function invoked when a search item is pressed or when the dialog\n   * should be closed.\n   */\n  toggleModal: () => void;\n  /**\n   * A function that returns custom content to render in the search modal in\n   * place of the default.\n   */\n  children?: (props: SearchModalChildrenProps) => JSX.Element;\n\n  /**\n   * Optional ability to pass in result item component renderers.\n   */\n  resultItemComponents?: SearchModalChildrenProps['resultItemComponents'];\n}\n\nconst useStyles = makeStyles(theme => ({\n  dialogTitle: {\n    gap: theme.spacing(1),\n    display: 'grid',\n    alignItems: 'center',\n    gridTemplateColumns: '1fr auto',\n    '&> button': {\n      marginTop: theme.spacing(1),\n    },\n  },\n  input: {\n    flex: 1,\n  },\n  button: {\n    '&:hover': {\n      background: 'none',\n    },\n  },\n  // Reduces default height of the modal, keeping a gap of 128px between the top and bottom of the page.\n  paperFullWidth: { height: 'calc(100% - 128px)' },\n  dialogActionsContainer: { padding: theme.spacing(1, 3) },\n  viewResultsLink: { verticalAlign: '0.5em' },\n}));\n\nexport const Modal = ({\n  toggleModal,\n  resultItemComponents,\n}: SearchModalChildrenProps) => {\n  const classes = useStyles();\n  const navigate = useNavigate();\n  const { transitions } = useTheme();\n  const { focusContent } = useContent();\n\n  const searchRootRoute = useRouteRef(rootRouteRef)();\n  const searchBarRef = useRef<HTMLInputElement | null>(null);\n\n  useEffect(() => {\n    searchBarRef?.current?.focus();\n  });\n\n  const handleSearchResultClick = useCallback(() => {\n    setTimeout(focusContent, transitions.duration.leavingScreen);\n  }, [focusContent, transitions]);\n\n  // This handler is called when \"enter\" is pressed\n  const handleSearchBarSubmit = useCallback(() => {\n    // Using ref to get the current field value without waiting for a query debounce\n    const query = searchBarRef.current?.value ?? '';\n    navigate(`${searchRootRoute}?query=${query}`);\n    handleSearchResultClick();\n  }, [navigate, handleSearchResultClick, searchRootRoute]);\n\n  return (\n    <>\n      <DialogTitle>\n        <Box className={classes.dialogTitle}>\n          <SearchBar\n            className={classes.input}\n            inputProps={{ ref: searchBarRef }}\n            onSubmit={handleSearchBarSubmit}\n          />\n\n          <IconButton aria-label=\"close\" onClick={toggleModal}>\n            <CloseIcon />\n          </IconButton>\n        </Box>\n      </DialogTitle>\n      <DialogContent>\n        <Grid\n          container\n          direction=\"row-reverse\"\n          justifyContent=\"flex-start\"\n          alignItems=\"center\"\n        >\n          <Grid item>\n            <Button\n              className={classes.button}\n              color=\"primary\"\n              endIcon={<ArrowForwardIcon />}\n              onClick={handleSearchBarSubmit}\n              disableRipple\n            >\n              View Full Results\n            </Button>\n          </Grid>\n        </Grid>\n        <Divider />\n        <SearchResult\n          onClick={handleSearchResultClick}\n          onKeyDown={handleSearchResultClick}\n        >\n          {resultItemComponents}\n        </SearchResult>\n      </DialogContent>\n      <DialogActions className={classes.dialogActionsContainer}>\n        <Grid container direction=\"row\">\n          <Grid item xs={12}>\n            <SearchResultPager />\n          </Grid>\n        </Grid>\n      </DialogActions>\n    </>\n  );\n};\n\n/**\n * @public\n */\nexport const SearchModal = (props: SearchModalProps) => {\n  const {\n    open = true,\n    hidden,\n    toggleModal,\n    children,\n    resultItemComponents,\n  } = props;\n\n  const classes = useStyles();\n\n  return (\n    <Dialog\n      classes={{\n        paperFullWidth: classes.paperFullWidth,\n      }}\n      onClose={toggleModal}\n      aria-label=\"Search Modal\"\n      aria-modal=\"true\"\n      fullWidth\n      maxWidth=\"lg\"\n      open={open}\n      hidden={hidden}\n    >\n      {open && (\n        <SearchContextProvider inheritParentContextIfAvailable>\n          {(children &&\n            children({\n              toggleModal,\n              resultItemComponents: resultItemComponents || [],\n            })) ?? (\n            <Modal\n              toggleModal={toggleModal}\n              resultItemComponents={resultItemComponents}\n            />\n          )}\n        </SearchContextProvider>\n      )}\n    </Dialog>\n  );\n};\n"],"names":[],"mappings":"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"}