{"version":3,"file":"useUserProfileInfo.esm.js","sources":["../../src/components/useUserProfileInfo.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  alertApiRef,\n  identityApiRef,\n  ProfileInfo,\n  useApi,\n} from '@backstage/core-plugin-api';\nimport { useEffect } from 'react';\nimport useAsync from 'react-use/esm/useAsync';\nimport { catalogApiRef } from '@backstage/plugin-catalog-react';\nimport { UserEntity } from '@backstage/catalog-model';\n\n/** @public */\nexport const useUserProfile = () => {\n  const identityApi = useApi(identityApiRef);\n  const alertApi = useApi(alertApiRef);\n  const catalogApi = useApi(catalogApiRef);\n\n  const { value, loading, error } = useAsync(async () => {\n    let identityProfile = await identityApi.getProfileInfo();\n    const backStageIdentity = await identityApi.getBackstageIdentity();\n    const catalogProfile = (await catalogApi.getEntityByRef(\n      backStageIdentity.userEntityRef,\n    )) as unknown as UserEntity;\n    if (\n      identityProfile.picture === undefined &&\n      catalogProfile?.spec?.profile?.picture\n    ) {\n      identityProfile = {\n        ...identityProfile,\n        picture: catalogProfile.spec.profile.picture,\n      };\n    }\n    return {\n      profile: identityProfile,\n      identity: backStageIdentity,\n    };\n  }, []);\n\n  useEffect(() => {\n    if (error) {\n      alertApi.post({\n        message: `Failed to load user identity: ${error}`,\n        severity: 'error',\n      });\n    }\n  }, [error, alertApi]);\n\n  if (loading || error) {\n    return {\n      profile: {} as ProfileInfo,\n      displayName: '',\n      loading,\n    };\n  }\n\n  return {\n    profile: value!.profile,\n    backstageIdentity: value!.identity,\n    displayName: value!.profile.displayName ?? value!.identity.userEntityRef,\n    loading,\n  };\n};\n"],"names":[],"mappings":";;;;;AA4BO,MAAM,iBAAiB,MAAM;AAClC,EAAM,MAAA,WAAA,GAAc,OAAO,cAAc,CAAA;AACzC,EAAM,MAAA,QAAA,GAAW,OAAO,WAAW,CAAA;AACnC,EAAM,MAAA,UAAA,GAAa,OAAO,aAAa,CAAA;AAEvC,EAAA,MAAM,EAAE,KAAO,EAAA,OAAA,EAAS,KAAM,EAAA,GAAI,SAAS,YAAY;AACrD,IAAI,IAAA,eAAA,GAAkB,MAAM,WAAA,CAAY,cAAe,EAAA;AACvD,IAAM,MAAA,iBAAA,GAAoB,MAAM,WAAA,CAAY,oBAAqB,EAAA;AACjE,IAAM,MAAA,cAAA,GAAkB,MAAM,UAAW,CAAA,cAAA;AAAA,MACvC,iBAAkB,CAAA;AAAA,KACpB;AACA,IAAA,IACE,gBAAgB,OAAY,KAAA,KAAA,CAAA,IAC5B,cAAgB,EAAA,IAAA,EAAM,SAAS,OAC/B,EAAA;AACA,MAAkB,eAAA,GAAA;AAAA,QAChB,GAAG,eAAA;AAAA,QACH,OAAA,EAAS,cAAe,CAAA,IAAA,CAAK,OAAQ,CAAA;AAAA,OACvC;AAAA;AAEF,IAAO,OAAA;AAAA,MACL,OAAS,EAAA,eAAA;AAAA,MACT,QAAU,EAAA;AAAA,KACZ;AAAA,GACF,EAAG,EAAE,CAAA;AAEL,EAAA,SAAA,CAAU,MAAM;AACd,IAAA,IAAI,KAAO,EAAA;AACT,MAAA,QAAA,CAAS,IAAK,CAAA;AAAA,QACZ,OAAA,EAAS,iCAAiC,KAAK,CAAA,CAAA;AAAA,QAC/C,QAAU,EAAA;AAAA,OACX,CAAA;AAAA;AACH,GACC,EAAA,CAAC,KAAO,EAAA,QAAQ,CAAC,CAAA;AAEpB,EAAA,IAAI,WAAW,KAAO,EAAA;AACpB,IAAO,OAAA;AAAA,MACL,SAAS,EAAC;AAAA,MACV,WAAa,EAAA,EAAA;AAAA,MACb;AAAA,KACF;AAAA;AAGF,EAAO,OAAA;AAAA,IACL,SAAS,KAAO,CAAA,OAAA;AAAA,IAChB,mBAAmB,KAAO,CAAA,QAAA;AAAA,IAC1B,WAAa,EAAA,KAAA,CAAO,OAAQ,CAAA,WAAA,IAAe,MAAO,QAAS,CAAA,aAAA;AAAA,IAC3D;AAAA,GACF;AACF;;;;"}