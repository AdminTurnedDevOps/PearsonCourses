{"version":3,"file":"UserSettingsFeatureFlags.esm.js","sources":["../../../src/components/FeatureFlags/UserSettingsFeatureFlags.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback, useState } from 'react';\nimport List from '@material-ui/core/List';\nimport TextField from '@material-ui/core/TextField';\nimport IconButton from '@material-ui/core/IconButton';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport { EmptyFlags } from './EmptyFlags';\nimport { FlagItem } from './FeatureFlagsItem';\nimport {\n  FeatureFlag,\n  FeatureFlagsApi,\n  featureFlagsApiRef,\n  FeatureFlagState,\n  useApi,\n} from '@backstage/core-plugin-api';\nimport { InfoCard } from '@backstage/core-components';\nimport ClearIcon from '@material-ui/icons/Clear';\n\nexport const sortFlags = (\n  flags: FeatureFlag[],\n  featureFlagsApi: FeatureFlagsApi,\n): FeatureFlag[] => {\n  const activeFlags = flags.filter(flag => featureFlagsApi.isActive(flag.name));\n  const idleFlags = flags.filter(flag => !featureFlagsApi.isActive(flag.name));\n  return [...activeFlags, ...idleFlags];\n};\n\n/** @public */\nexport const UserSettingsFeatureFlags = () => {\n  const featureFlagsApi = useApi(featureFlagsApiRef);\n  const inputRef = React.useRef<HTMLElement>();\n\n  const initialFeatureFlags = featureFlagsApi.getRegisteredFlags();\n  const initialFeatureFlagsSorted = sortFlags(\n    initialFeatureFlags,\n    featureFlagsApi,\n  );\n  const [featureFlags] = useState(initialFeatureFlagsSorted);\n\n  const initialFlagState = Object.fromEntries(\n    featureFlags.map(({ name }) => [name, featureFlagsApi.isActive(name)]),\n  );\n\n  const [state, setState] = useState<Record<string, boolean>>(initialFlagState);\n  const [filterInput, setFilterInput] = useState<string>('');\n\n  const toggleFlag = useCallback(\n    (flagName: string) => {\n      const newState = featureFlagsApi.isActive(flagName)\n        ? FeatureFlagState.None\n        : FeatureFlagState.Active;\n\n      featureFlagsApi.save({\n        states: { [flagName]: newState },\n        merge: true,\n      });\n\n      setState(prevState => ({\n        ...prevState,\n        [flagName]: newState === FeatureFlagState.Active,\n      }));\n    },\n    [featureFlagsApi],\n  );\n\n  if (!featureFlags.length) {\n    return <EmptyFlags />;\n  }\n\n  const clearFilterInput = () => {\n    setFilterInput('');\n    inputRef?.current?.focus();\n  };\n\n  const filteredFeatureFlags = featureFlags.filter(featureFlag => {\n    const featureFlagName = featureFlag.name.toLocaleLowerCase('en-US');\n    return featureFlagName.includes(filterInput.toLocaleLowerCase('en-US'));\n  });\n\n  const Header = () => (\n    <Grid container style={{ justifyContent: 'space-between' }}>\n      <Grid item xs={6} md={8}>\n        <Typography variant=\"h5\">Feature Flags</Typography>\n        <Typography variant=\"subtitle1\">\n          Please refresh the page when toggling feature flags\n        </Typography>\n      </Grid>\n      {featureFlags.length >= 10 && (\n        <Grid item xs={6} md={4}>\n          <TextField\n            label=\"Filter\"\n            style={{ display: 'flex', justifyContent: 'flex-end' }}\n            inputRef={ref => ref && ref.focus()}\n            InputProps={{\n              ...(filterInput.length && {\n                endAdornment: (\n                  <IconButton\n                    aria-label=\"Clear filter\"\n                    onClick={clearFilterInput}\n                    edge=\"end\"\n                  >\n                    <ClearIcon />\n                  </IconButton>\n                ),\n              }),\n            }}\n            onChange={e => setFilterInput(e.target.value)}\n            value={filterInput}\n          />\n        </Grid>\n      )}\n    </Grid>\n  );\n\n  return (\n    <InfoCard title={<Header />}>\n      <List dense>\n        {filteredFeatureFlags.map(featureFlag => {\n          const enabled = Boolean(state[featureFlag.name]);\n\n          return (\n            <FlagItem\n              key={featureFlag.name}\n              flag={featureFlag}\n              enabled={enabled}\n              toggleHandler={toggleFlag}\n            />\n          );\n        })}\n      </List>\n    </InfoCard>\n  );\n};\n"],"names":[],"mappings":"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"}