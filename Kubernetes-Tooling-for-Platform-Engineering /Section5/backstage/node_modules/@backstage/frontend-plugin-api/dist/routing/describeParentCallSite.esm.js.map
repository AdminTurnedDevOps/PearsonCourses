{"version":3,"file":"describeParentCallSite.esm.js","sources":["../../src/routing/describeParentCallSite.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst MESSAGE_MARKER = 'eHgtF5hmbrXyiEvo';\n\n// NOTE: This function is also imported and used in backend code\n\n/**\n * Internal helper that describes the location of the parent caller.\n * @internal\n */\nexport function describeParentCallSite(\n  ErrorConstructor: { new (message: string): Error } = Error,\n): string {\n  const { stack } = new ErrorConstructor(MESSAGE_MARKER);\n  if (!stack) {\n    return '<unknown>';\n  }\n\n  // Safari and Firefox don't include the error itself in the stack\n  const startIndex = stack.includes(MESSAGE_MARKER)\n    ? stack.indexOf('\\n') + 1\n    : 0;\n  const secondEntryStart =\n    stack.indexOf('\\n', stack.indexOf('\\n', startIndex) + 1) + 1;\n  const secondEntryEnd = stack.indexOf('\\n', secondEntryStart);\n\n  const line = stack.substring(secondEntryStart, secondEntryEnd).trim();\n  if (!line) {\n    return 'unknown';\n  }\n\n  // Below we try to extract the location for different browsers.\n  // Since RouteRefs are declared at the top-level of modules the caller name isn't interesting.\n\n  // Chrome\n  if (line.includes('(')) {\n    return line.substring(line.indexOf('(') + 1, line.indexOf(')'));\n  }\n\n  // Safari & Firefox\n  if (line.includes('@')) {\n    return line.substring(line.indexOf('@') + 1);\n  }\n\n  // Give up\n  return line;\n}\n"],"names":[],"mappings":"AAgBA,MAAM,cAAiB,GAAA,kBAAA;AAQP,SAAA,sBAAA,CACd,mBAAqD,KAC7C,EAAA;AACR,EAAA,MAAM,EAAE,KAAA,EAAU,GAAA,IAAI,iBAAiB,cAAc,CAAA;AACrD,EAAA,IAAI,CAAC,KAAO,EAAA;AACV,IAAO,OAAA,WAAA;AAAA;AAIT,EAAM,MAAA,UAAA,GAAa,MAAM,QAAS,CAAA,cAAc,IAC5C,KAAM,CAAA,OAAA,CAAQ,IAAI,CAAA,GAAI,CACtB,GAAA,CAAA;AACJ,EAAM,MAAA,gBAAA,GACJ,KAAM,CAAA,OAAA,CAAQ,IAAM,EAAA,KAAA,CAAM,QAAQ,IAAM,EAAA,UAAU,CAAI,GAAA,CAAC,CAAI,GAAA,CAAA;AAC7D,EAAA,MAAM,cAAiB,GAAA,KAAA,CAAM,OAAQ,CAAA,IAAA,EAAM,gBAAgB,CAAA;AAE3D,EAAA,MAAM,OAAO,KAAM,CAAA,SAAA,CAAU,gBAAkB,EAAA,cAAc,EAAE,IAAK,EAAA;AACpE,EAAA,IAAI,CAAC,IAAM,EAAA;AACT,IAAO,OAAA,SAAA;AAAA;AAOT,EAAI,IAAA,IAAA,CAAK,QAAS,CAAA,GAAG,CAAG,EAAA;AACtB,IAAO,OAAA,IAAA,CAAK,SAAU,CAAA,IAAA,CAAK,OAAQ,CAAA,GAAG,IAAI,CAAG,EAAA,IAAA,CAAK,OAAQ,CAAA,GAAG,CAAC,CAAA;AAAA;AAIhE,EAAI,IAAA,IAAA,CAAK,QAAS,CAAA,GAAG,CAAG,EAAA;AACtB,IAAA,OAAO,KAAK,SAAU,CAAA,IAAA,CAAK,OAAQ,CAAA,GAAG,IAAI,CAAC,CAAA;AAAA;AAI7C,EAAO,OAAA,IAAA;AACT;;;;"}