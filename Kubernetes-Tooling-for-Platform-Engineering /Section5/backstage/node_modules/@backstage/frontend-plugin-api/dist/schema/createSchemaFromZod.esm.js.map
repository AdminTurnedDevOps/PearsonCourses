{"version":3,"file":"createSchemaFromZod.esm.js","sources":["../../src/schema/createSchemaFromZod.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { JsonObject } from '@backstage/types';\nimport { z, ZodSchema, ZodTypeDef } from 'zod';\nimport zodToJsonSchema from 'zod-to-json-schema';\nimport { PortableSchema } from './types';\n\n/**\n * @internal\n */\nexport function createSchemaFromZod<TOutput, TInput>(\n  schemaCreator: (zImpl: typeof z) => ZodSchema<TOutput, ZodTypeDef, TInput>,\n): PortableSchema<TOutput, TInput> {\n  const schema = schemaCreator(z);\n  return {\n    // TODO: Types allow z.array etc here but it will break stuff\n    parse: input => {\n      const result = schema.safeParse(input);\n      if (result.success) {\n        return result.data;\n      }\n\n      throw new Error(result.error.issues.map(formatIssue).join('; '));\n    },\n    // TODO: Verify why we are not compatible with the latest zodToJsonSchema.\n    schema: zodToJsonSchema(schema) as JsonObject,\n  };\n}\n\nfunction formatIssue(issue: z.ZodIssue): string {\n  if (issue.code === 'invalid_union') {\n    return formatIssue(issue.unionErrors[0].issues[0]);\n  }\n  let message = issue.message;\n  if (message === 'Required') {\n    message = `Missing required value`;\n  }\n  if (issue.path.length) {\n    message += ` at '${issue.path.join('.')}'`;\n  }\n  return message;\n}\n"],"names":[],"mappings":";;;AAwBO,SAAS,oBACd,aACiC,EAAA;AACjC,EAAM,MAAA,MAAA,GAAS,cAAc,CAAC,CAAA;AAC9B,EAAO,OAAA;AAAA;AAAA,IAEL,OAAO,CAAS,KAAA,KAAA;AACd,MAAM,MAAA,MAAA,GAAS,MAAO,CAAA,SAAA,CAAU,KAAK,CAAA;AACrC,MAAA,IAAI,OAAO,OAAS,EAAA;AAClB,QAAA,OAAO,MAAO,CAAA,IAAA;AAAA;AAGhB,MAAM,MAAA,IAAI,KAAM,CAAA,MAAA,CAAO,KAAM,CAAA,MAAA,CAAO,IAAI,WAAW,CAAA,CAAE,IAAK,CAAA,IAAI,CAAC,CAAA;AAAA,KACjE;AAAA;AAAA,IAEA,MAAA,EAAQ,gBAAgB,MAAM;AAAA,GAChC;AACF;AAEA,SAAS,YAAY,KAA2B,EAAA;AAC9C,EAAI,IAAA,KAAA,CAAM,SAAS,eAAiB,EAAA;AAClC,IAAA,OAAO,YAAY,KAAM,CAAA,WAAA,CAAY,CAAC,CAAE,CAAA,MAAA,CAAO,CAAC,CAAC,CAAA;AAAA;AAEnD,EAAA,IAAI,UAAU,KAAM,CAAA,OAAA;AACpB,EAAA,IAAI,YAAY,UAAY,EAAA;AAC1B,IAAU,OAAA,GAAA,CAAA,sBAAA,CAAA;AAAA;AAEZ,EAAI,IAAA,KAAA,CAAM,KAAK,MAAQ,EAAA;AACrB,IAAA,OAAA,IAAW,CAAQ,KAAA,EAAA,KAAA,CAAM,IAAK,CAAA,IAAA,CAAK,GAAG,CAAC,CAAA,CAAA,CAAA;AAAA;AAEzC,EAAO,OAAA,OAAA;AACT;;;;"}