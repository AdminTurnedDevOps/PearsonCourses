{"version":3,"file":"MarkdownContent.esm.js","sources":["../../../src/components/MarkdownContent/MarkdownContent.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport ReactMarkdown, { Options } from 'react-markdown';\nimport gfm from 'remark-gfm';\nimport React from 'react';\nimport { CodeSnippet } from '../CodeSnippet';\nimport { HeadingProps } from 'react-markdown/lib/ast-to-react';\n\nexport type MarkdownContentClassKey = 'markdown';\n\nconst useStyles = makeStyles(\n  theme => ({\n    markdown: {\n      '& table': {\n        borderCollapse: 'collapse',\n        border: `1px solid ${theme.palette.border}`,\n      },\n      '& th, & td': {\n        border: `1px solid ${theme.palette.border}`,\n        padding: theme.spacing(1),\n      },\n      '& td': {\n        wordBreak: 'break-word',\n        overflow: 'hidden',\n        verticalAlign: 'middle',\n        lineHeight: '1',\n        margin: 0,\n        padding: theme.spacing(3, 2, 3, 2.5),\n        borderBottom: 0,\n      },\n      '& th': {\n        backgroundColor: theme.palette.background.paper,\n      },\n      '& tr': {\n        backgroundColor: theme.palette.background.paper,\n      },\n      '& tr:nth-child(odd)': {\n        backgroundColor: theme.palette.background.default,\n      },\n\n      '& a': {\n        color: theme.palette.link,\n      },\n      '& img': {\n        maxWidth: '100%',\n      },\n    },\n  }),\n  { name: 'BackstageMarkdownContent' },\n);\n\ntype Props = {\n  content: string;\n  dialect?: 'gfm' | 'common-mark';\n  linkTarget?: Options['linkTarget'];\n  transformLinkUri?: (href: string) => string;\n  transformImageUri?: (href: string) => string;\n  className?: string;\n};\n\nconst flatten = (text: string, child: any): string => {\n  if (!child) return text;\n\n  return typeof child === 'string'\n    ? text + child\n    : React.Children.toArray(child.props.children).reduce(flatten, text);\n};\n\nconst headingRenderer = ({ level, children }: HeadingProps) => {\n  const childrenArray = React.Children.toArray(children);\n  const text = childrenArray.reduce(flatten, '');\n  const slug = text.toLocaleLowerCase('en-US').replace(/\\W/g, '-');\n  return React.createElement(`h${level}`, { id: slug }, children);\n};\n\nconst components: Options['components'] = {\n  code: ({ inline, className, children, ...props }) => {\n    const text = String(children).replace(/\\n+$/, '');\n    const match = /language-(\\w+)/.exec(className || '');\n    return !inline && match ? (\n      <CodeSnippet language={match[1]} text={text} />\n    ) : (\n      <code className={className} {...props}>\n        {children}\n      </code>\n    );\n  },\n  h1: headingRenderer,\n  h2: headingRenderer,\n  h3: headingRenderer,\n  h4: headingRenderer,\n  h5: headingRenderer,\n  h6: headingRenderer,\n};\n\n/**\n * Renders markdown with the default dialect {@link https://github.github.com/gfm/ | gfm - GitHub flavored Markdown} to backstage theme styled HTML.\n *\n * @remarks\n * If you just want to render to plain {@link https://commonmark.org/ | CommonMark}, set the dialect to `'common-mark'`\n */\nexport function MarkdownContent(props: Props) {\n  const {\n    content,\n    dialect = 'gfm',\n    linkTarget,\n    transformLinkUri,\n    transformImageUri,\n    className,\n  } = props;\n  const classes = useStyles();\n  return (\n    <ReactMarkdown\n      remarkPlugins={dialect === 'gfm' ? [gfm] : []}\n      className={`${classes.markdown} ${className ?? ''}`.trim()}\n      children={content}\n      components={components}\n      linkTarget={linkTarget}\n      transformLinkUri={transformLinkUri}\n      transformImageUri={transformImageUri}\n    />\n  );\n}\n"],"names":["React"],"mappings":"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"}