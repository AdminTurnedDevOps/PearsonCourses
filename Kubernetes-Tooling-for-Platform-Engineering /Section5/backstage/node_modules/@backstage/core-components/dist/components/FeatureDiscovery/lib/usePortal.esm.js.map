{"version":3,"file":"usePortal.esm.js","sources":["../../../../src/components/FeatureDiscovery/lib/usePortal.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { useRef, useEffect } from 'react';\n\n/**\n * Creates DOM element to be used as React root.\n */\nfunction createRootElement(id: string): Element {\n  const rootContainer = document.createElement('div');\n  rootContainer.setAttribute('id', id);\n  return rootContainer;\n}\n\n/**\n * Appends element as last child of body.\n */\nfunction addRootElement(rootElem: Element): void {\n  document.body.insertBefore(\n    rootElem,\n    document.body.lastElementChild!.nextElementSibling,\n  );\n}\n\n/**\n * Hook to create a React Portal.\n *\n * Automatically handles creating and tearing-down the root elements (no SRR\n * makes this trivial), so there is no need to ensure the parent target already\n * exists.\n *\n * @example\n * const target = usePortal(id, [id]);\n * return createPortal(children, target);\n *\n * @param id - The id of the target container, e.g 'modal' or 'spotlight'\n * @returns The DOM node to use as the Portal target.\n */\nexport function usePortal(id: string): HTMLElement {\n  const rootElemRef = useRef<HTMLElement | null>(null);\n\n  useEffect(\n    function setupElement() {\n      // Look for existing target dom element to append to\n      const existingParent = document.querySelector(`#${id}`);\n      // Parent is either a new root or the existing dom element\n      const parentElem = existingParent || createRootElement(id);\n\n      // If there is no existing DOM element, add a new one.\n      if (!existingParent) {\n        addRootElement(parentElem);\n      }\n\n      // Add the detached element to the parent\n      parentElem.appendChild(rootElemRef.current!);\n\n      return function removeElement() {\n        rootElemRef.current!.remove();\n        if (parentElem.childNodes.length === -1) {\n          parentElem.remove();\n        }\n      };\n    },\n    [id],\n  );\n\n  /**\n   * It's important we evaluate this lazily:\n   * - We need first render to contain the DOM element, so it shouldn't happen\n   *   in useEffect. We would normally put this in the constructor().\n   * - We can't do 'const rootElemRef = useRef(document.createElement('div))',\n   *   since this will run every single render (that's a lot).\n   * - We want the ref to consistently point to the same DOM element and only\n   *   ever run once.\n   * @link https://reactjs.org/docs/hooks-faq.html#how-to-create-expensive-objects-lazily\n   */\n  function getRootElem() {\n    if (!rootElemRef.current) {\n      rootElemRef.current = document.createElement('div');\n    }\n    return rootElemRef.current;\n  }\n\n  return getRootElem();\n}\n\nexport default usePortal;\n"],"names":[],"mappings":";;AAoBA,SAAS,kBAAkB,EAAqB,EAAA;AAC9C,EAAM,MAAA,aAAA,GAAgB,QAAS,CAAA,aAAA,CAAc,KAAK,CAAA;AAClD,EAAc,aAAA,CAAA,YAAA,CAAa,MAAM,EAAE,CAAA;AACnC,EAAO,OAAA,aAAA;AACT;AAKA,SAAS,eAAe,QAAyB,EAAA;AAC/C,EAAA,QAAA,CAAS,IAAK,CAAA,YAAA;AAAA,IACZ,QAAA;AAAA,IACA,QAAA,CAAS,KAAK,gBAAkB,CAAA;AAAA,GAClC;AACF;AAgBO,SAAS,UAAU,EAAyB,EAAA;AACjD,EAAM,MAAA,WAAA,GAAc,OAA2B,IAAI,CAAA;AAEnD,EAAA,SAAA;AAAA,IACE,SAAS,YAAe,GAAA;AAEtB,MAAA,MAAM,cAAiB,GAAA,QAAA,CAAS,aAAc,CAAA,CAAA,CAAA,EAAI,EAAE,CAAE,CAAA,CAAA;AAEtD,MAAM,MAAA,UAAA,GAAa,cAAkB,IAAA,iBAAA,CAAkB,EAAE,CAAA;AAGzD,MAAA,IAAI,CAAC,cAAgB,EAAA;AACnB,QAAA,cAAA,CAAe,UAAU,CAAA;AAAA;AAI3B,MAAW,UAAA,CAAA,WAAA,CAAY,YAAY,OAAQ,CAAA;AAE3C,MAAA,OAAO,SAAS,aAAgB,GAAA;AAC9B,QAAA,WAAA,CAAY,QAAS,MAAO,EAAA;AAC5B,QAAI,IAAA,UAAA,CAAW,UAAW,CAAA,MAAA,KAAW,CAAI,CAAA,EAAA;AACvC,UAAA,UAAA,CAAW,MAAO,EAAA;AAAA;AACpB,OACF;AAAA,KACF;AAAA,IACA,CAAC,EAAE;AAAA,GACL;AAYA,EAAA,SAAS,WAAc,GAAA;AACrB,IAAI,IAAA,CAAC,YAAY,OAAS,EAAA;AACxB,MAAY,WAAA,CAAA,OAAA,GAAU,QAAS,CAAA,aAAA,CAAc,KAAK,CAAA;AAAA;AAEpD,IAAA,OAAO,WAAY,CAAA,OAAA;AAAA;AAGrB,EAAA,OAAO,WAAY,EAAA;AACrB;;;;"}