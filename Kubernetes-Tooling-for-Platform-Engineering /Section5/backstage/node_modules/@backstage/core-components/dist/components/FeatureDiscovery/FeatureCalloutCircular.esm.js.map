{"version":3,"file":"FeatureCalloutCircular.esm.js","sources":["../../../src/components/FeatureDiscovery/FeatureCalloutCircular.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport Box from '@material-ui/core/Box';\nimport ClickAwayListener from '@material-ui/core/ClickAwayListener';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport React, {\n  PropsWithChildren,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useRef,\n  useState,\n} from 'react';\nimport { createPortal } from 'react-dom';\n\nimport { usePortal } from './lib/usePortal';\nimport { useShowCallout } from './lib/useShowCallout';\n\n/** @public */\nexport type FeatureCalloutCircleClassKey =\n  | '@keyframes pulsateSlightly'\n  | '@keyframes pulsateAndFade'\n  | 'featureWrapper'\n  | 'backdrop'\n  | 'dot'\n  | 'pulseCircle'\n  | 'text';\n\nconst useStyles = makeStyles(\n  theme => ({\n    '@keyframes pulsateSlightly': {\n      '0%': { transform: 'scale(1.0)' },\n      '100%': { transform: 'scale(1.1)' },\n    },\n    '@keyframes pulsateAndFade': {\n      '0%': { transform: 'scale(1.0)', opacity: 0.9 },\n      '100%': { transform: 'scale(1.5)', opacity: 0 },\n    },\n    featureWrapper: {\n      position: 'relative',\n    },\n    backdrop: {\n      zIndex: 2000,\n      position: 'fixed',\n      overflow: 'hidden',\n      left: 0,\n      right: 0,\n      top: 0,\n      bottom: 0,\n    },\n    dot: {\n      position: 'absolute',\n      backgroundColor: 'transparent',\n      borderRadius: '100%',\n      border: '1px solid rgba(103, 146, 180, 0.98)',\n      boxShadow: '0px 0px 0px 20000px rgba(0, 0, 0, 0.5)',\n      zIndex: 2001,\n      transformOrigin: 'center center',\n      animation:\n        '$pulsateSlightly 1744ms 1.2s cubic-bezier(0.4, 0, 0.2, 1) alternate infinite',\n    },\n    pulseCircle: {\n      width: '100%',\n      height: '100%',\n      backgroundColor: 'transparent',\n      borderRadius: '100%',\n      border: `2px solid ${theme.palette.common.white}`,\n      zIndex: 2001,\n      transformOrigin: 'center center',\n      animation:\n        '$pulsateAndFade 872ms 1.2s cubic-bezier(0.4, 0, 0.2, 1) infinite',\n    },\n    text: {\n      position: 'absolute',\n      color: theme.palette.common.white,\n      zIndex: 2003,\n    },\n  }),\n  { name: 'BackstageFeatureCalloutCircular' },\n);\n\nexport type Props = {\n  featureId: string;\n  title: string;\n  description: string;\n};\n\ntype Placement = {\n  dotLeft: number;\n  dotTop: number;\n  dotSize: number;\n  borderWidth: number;\n  textLeft: number;\n  textTop: number;\n  textWidth: number;\n};\n\n/**\n * One-time, round 'telescope' animation showing new feature.\n *\n * @public\n *\n */\nexport function FeatureCalloutCircular(props: PropsWithChildren<Props>) {\n  const { featureId, title, description, children } = props;\n  const { show, hide } = useShowCallout(featureId);\n  const portalElement = usePortal('core.callout');\n  const wrapperRef = useRef<HTMLDivElement>(null);\n  const [placement, setPlacement] = useState<Placement | undefined>();\n  const classes = useStyles();\n\n  const update = useCallback(() => {\n    if (wrapperRef.current) {\n      const wrapperBounds = wrapperRef.current.getBoundingClientRect();\n      const longest = Math.max(wrapperBounds.width, wrapperBounds.height);\n\n      const borderWidth = 800;\n      const dotLeft =\n        wrapperBounds.x - (longest - wrapperBounds.width) / 2 - borderWidth;\n      const dotTop =\n        wrapperBounds.y - (longest - wrapperBounds.height) / 2 - borderWidth;\n      const dotSize = longest + 2 * borderWidth;\n\n      const textWidth = 450;\n      const textLeft = wrapperBounds.x + wrapperBounds.width / 2 - textWidth;\n      const textTop =\n        wrapperBounds.y - (longest - wrapperBounds.height) / 2 + longest + 20;\n\n      setPlacement({\n        dotLeft,\n        dotTop,\n        dotSize,\n        borderWidth,\n        textTop,\n        textLeft,\n        textWidth,\n      });\n    }\n  }, []);\n\n  useEffect(() => {\n    window.addEventListener('resize', update);\n    window.addEventListener('scroll', update);\n    return () => {\n      window.removeEventListener('resize', update);\n      window.removeEventListener('scroll', update);\n    };\n  }, [update]);\n\n  useLayoutEffect(update, [wrapperRef.current, update]);\n\n  if (!show) {\n    return <>{children}</>;\n  }\n\n  return (\n    <>\n      <Box className={classes.featureWrapper} {...{ ref: wrapperRef }}>\n        {children}\n      </Box>\n      {createPortal(\n        <Box className={classes.backdrop}>\n          <ClickAwayListener onClickAway={hide}>\n            <>\n              <Box\n                className={classes.dot}\n                data-testid=\"dot\"\n                style={{\n                  left: placement?.dotLeft,\n                  top: placement?.dotTop,\n                  width: placement?.dotSize,\n                  height: placement?.dotSize,\n                  borderWidth: placement?.borderWidth,\n                }}\n                onClick={hide}\n                onKeyDown={hide}\n                role=\"button\"\n                tabIndex={0}\n              >\n                <Box className={classes.pulseCircle} />\n              </Box>\n              <Box\n                className={classes.text}\n                data-testid=\"text\"\n                style={{\n                  left: placement?.textLeft,\n                  top: placement?.textTop,\n                  width: placement?.textWidth,\n                }}\n              >\n                <Typography variant=\"h2\" paragraph>\n                  {title}\n                </Typography>\n                <Typography>{description}</Typography>\n              </Box>\n            </>\n          </ClickAwayListener>\n        </Box>,\n        portalElement,\n      )}\n    </>\n  );\n}\n"],"names":["React"],"mappings":"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"}