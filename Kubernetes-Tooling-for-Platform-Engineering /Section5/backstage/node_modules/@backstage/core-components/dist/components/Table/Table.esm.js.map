{"version":3,"file":"Table.esm.js","sources":["../../../src/components/Table/Table.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport MTable, {\n  Column,\n  Icons,\n  MaterialTableProps,\n  MTableBody,\n  MTableHeader,\n  MTableToolbar,\n  Options,\n} from '@material-table/core';\nimport Box from '@material-ui/core/Box';\nimport IconButton from '@material-ui/core/IconButton';\nimport {\n  makeStyles,\n  Theme,\n  useTheme,\n  withStyles,\n} from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport AddBox from '@material-ui/icons/AddBox';\nimport ArrowUpward from '@material-ui/icons/ArrowUpward';\nimport Check from '@material-ui/icons/Check';\nimport ChevronLeft from '@material-ui/icons/ChevronLeft';\nimport ChevronRight from '@material-ui/icons/ChevronRight';\nimport Clear from '@material-ui/icons/Clear';\nimport DeleteOutline from '@material-ui/icons/DeleteOutline';\nimport Edit from '@material-ui/icons/Edit';\nimport FilterList from '@material-ui/icons/FilterList';\nimport Search from '@material-ui/icons/Search';\nimport FirstPage from '@material-ui/icons/FirstPage';\nimport LastPage from '@material-ui/icons/LastPage';\nimport Remove from '@material-ui/icons/Remove';\nimport SaveAlt from '@material-ui/icons/SaveAlt';\nimport ViewColumn from '@material-ui/icons/ViewColumn';\nimport { isEqual, transform } from 'lodash';\nimport React, {\n  forwardRef,\n  MutableRefObject,\n  ReactNode,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react';\n\nimport { SelectProps } from '../Select/Select';\nimport { Filter, Filters, SelectedFilters, Without } from './Filters';\nimport { TableLoadingBody } from './TableLoadingBody';\n\n// Material-table is not using the standard icons available in in material-ui. https://github.com/mbrn/material-table/issues/51\nconst tableIcons: Icons = {\n  Add: forwardRef<SVGSVGElement>((props, ref) => (\n    <AddBox {...props} ref={ref} />\n  )),\n  Check: forwardRef<SVGSVGElement>((props, ref) => (\n    <Check {...props} ref={ref} />\n  )),\n  Clear: forwardRef<SVGSVGElement>((props, ref) => (\n    <Clear {...props} ref={ref} />\n  )),\n  Delete: forwardRef<SVGSVGElement>((props, ref) => (\n    <DeleteOutline {...props} ref={ref} />\n  )),\n  DetailPanel: forwardRef<SVGSVGElement>((props, ref) => (\n    <ChevronRight {...props} ref={ref} />\n  )),\n  Edit: forwardRef<SVGSVGElement>((props, ref) => (\n    <Edit {...props} ref={ref} />\n  )),\n  Export: forwardRef<SVGSVGElement>((props, ref) => (\n    <SaveAlt {...props} ref={ref} />\n  )),\n  Filter: forwardRef<SVGSVGElement>((props, ref) => (\n    <FilterList {...props} ref={ref} />\n  )),\n  FirstPage: forwardRef<SVGSVGElement>((props, ref) => (\n    <FirstPage {...props} ref={ref} />\n  )),\n  LastPage: forwardRef<SVGSVGElement>((props, ref) => (\n    <LastPage {...props} ref={ref} />\n  )),\n  NextPage: forwardRef<SVGSVGElement>((props, ref) => (\n    <ChevronRight {...props} ref={ref} />\n  )),\n  PreviousPage: forwardRef<SVGSVGElement>((props, ref) => (\n    <ChevronLeft {...props} ref={ref} />\n  )),\n  ResetSearch: forwardRef<SVGSVGElement>((props, ref) => (\n    <Clear {...props} ref={ref} />\n  )),\n  Search: forwardRef<SVGSVGElement>((props, ref) => (\n    <Search {...props} ref={ref} />\n  )),\n  SortArrow: forwardRef<SVGSVGElement>((props, ref) => (\n    <ArrowUpward {...props} ref={ref} />\n  )),\n  ThirdStateCheck: forwardRef<SVGSVGElement>((props, ref) => (\n    <Remove {...props} ref={ref} />\n  )),\n  ViewColumn: forwardRef<SVGSVGElement>((props, ref) => (\n    <ViewColumn {...props} ref={ref} />\n  )),\n};\n\n// TODO: Material table might already have such a function internally that we can use?\nfunction extractValueByField(data: any, field: string): any | undefined {\n  const path = field.split('.');\n  let value = data[path[0]];\n\n  for (let i = 1; i < path.length; ++i) {\n    if (value === undefined) {\n      return value;\n    }\n\n    const f = path[i];\n    value = value[f];\n  }\n\n  return value;\n}\n\nexport type TableHeaderClassKey = 'header';\n\nconst StyledMTableHeader = withStyles(\n  theme => ({\n    header: {\n      padding: theme.spacing(1, 2, 1, 2.5),\n      borderTop: `1px solid ${theme.palette.grey.A100}`,\n      borderBottom: `1px solid ${theme.palette.grey.A100}`,\n      // withStyles hasn't a generic overload for theme\n      fontWeight: theme.typography.fontWeightBold,\n      position: 'static',\n      wordBreak: 'normal',\n      textTransform: 'uppercase',\n    },\n  }),\n  { name: 'BackstageTableHeader' },\n)(MTableHeader);\n\nexport type TableToolbarClassKey = 'root' | 'title' | 'searchField';\n\nconst StyledMTableToolbar = withStyles(\n  theme => ({\n    root: {\n      padding: theme.spacing(3, 0, 2.5, 2.5),\n    },\n    title: {\n      '& > h6': {\n        fontWeight: theme.typography.fontWeightBold,\n      },\n    },\n    searchField: {\n      paddingRight: theme.spacing(2),\n    },\n  }),\n  { name: 'BackstageTableToolbar' },\n)(MTableToolbar);\n\n/** @public */\nexport type FiltersContainerClassKey = 'root' | 'title';\n\nconst useFilterStyles = makeStyles(\n  theme => ({\n    root: {\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'space-between',\n    },\n    title: {\n      fontWeight: theme.typography.fontWeightBold,\n      fontSize: 18,\n      whiteSpace: 'nowrap',\n    },\n  }),\n  { name: 'BackstageTableFiltersContainer' },\n);\n\nexport type TableClassKey = 'root';\n\nconst useTableStyles = makeStyles(\n  () => ({\n    root: {\n      display: 'flex',\n      alignItems: 'start',\n    },\n  }),\n  { name: 'BackstageTable' },\n);\n\nfunction convertColumns<T extends object>(\n  columns: TableColumn<T>[],\n  theme: Theme,\n): TableColumn<T>[] {\n  return columns.map(column => {\n    const headerStyle: React.CSSProperties = column.headerStyle ?? {};\n\n    let cellStyle = column.cellStyle || {};\n\n    if (column.highlight) {\n      headerStyle.color = theme.palette.textContrast;\n\n      if (typeof cellStyle === 'object') {\n        (cellStyle as React.CSSProperties).fontWeight =\n          theme.typography.fontWeightBold;\n      } else {\n        const cellStyleFn = cellStyle as (\n          data: any,\n          rowData: T,\n          column?: Column<T>,\n        ) => React.CSSProperties;\n        cellStyle = (data, rowData, rowColumn) => {\n          const style = cellStyleFn(data, rowData, rowColumn);\n          return { ...style, fontWeight: theme.typography.fontWeightBold };\n        };\n      }\n    }\n\n    return {\n      ...column,\n      headerStyle,\n      cellStyle,\n    };\n  });\n}\n\nfunction removeDefaultValues(state: any, defaultState: any): any {\n  return transform(state, (result, value, key) => {\n    if (!isEqual(value, defaultState[key])) {\n      result[key] = value;\n    }\n  });\n}\n\nconst defaultInitialState = {\n  search: '',\n  filtersOpen: false,\n  filters: {},\n};\n\nexport interface TableColumn<T extends object = {}> extends Column<T> {\n  highlight?: boolean;\n  width?: string;\n}\n\nexport type TableFilter = {\n  column: string;\n  type: 'select' | 'multiple-select';\n};\n\nexport type TableState = {\n  search?: string;\n  filtersOpen?: boolean;\n  filters?: SelectedFilters;\n};\n\nexport interface TableProps<T extends object = {}>\n  extends MaterialTableProps<T> {\n  columns: TableColumn<T>[];\n  subtitle?: string;\n  filters?: TableFilter[];\n  initialState?: TableState;\n  emptyContent?: ReactNode;\n  isLoading?: boolean;\n  onStateChange?: (state: TableState) => any;\n}\n\nexport interface TableOptions<T extends object = {}> extends Options<T> {}\n\nexport function TableToolbar(toolbarProps: {\n  toolbarRef: MutableRefObject<any>;\n  setSearch: (value: string) => void;\n  onSearchChanged: (value: string) => void;\n  toggleFilters: () => void;\n  hasFilters: boolean;\n  selectedFiltersLength: number;\n}) {\n  const {\n    toolbarRef,\n    setSearch,\n    hasFilters,\n    selectedFiltersLength,\n    toggleFilters,\n  } = toolbarProps;\n  const filtersClasses = useFilterStyles();\n  const onSearchChanged = useCallback(\n    (searchText: string) => {\n      toolbarProps.onSearchChanged(searchText);\n      setSearch(searchText);\n    },\n    [toolbarProps, setSearch],\n  );\n\n  if (hasFilters) {\n    return (\n      <Box className={filtersClasses.root}>\n        <Box className={filtersClasses.root}>\n          <IconButton onClick={toggleFilters} aria-label=\"filter list\">\n            <FilterList />\n          </IconButton>\n          <Typography className={filtersClasses.title}>\n            Filters ({selectedFiltersLength})\n          </Typography>\n        </Box>\n        <StyledMTableToolbar\n          {...toolbarProps}\n          ref={toolbarRef}\n          onSearchChanged={onSearchChanged}\n        />\n      </Box>\n    );\n  }\n\n  return (\n    <StyledMTableToolbar\n      {...toolbarProps}\n      ref={toolbarRef}\n      onSearchChanged={onSearchChanged}\n    />\n  );\n}\n\n/**\n * @public\n */\nexport function Table<T extends object = {}>(props: TableProps<T>) {\n  const {\n    data,\n    columns,\n    emptyContent,\n    options,\n    title,\n    subtitle,\n    localization,\n    filters,\n    initialState,\n    onStateChange,\n    components,\n    isLoading: loading,\n    style,\n    ...restProps\n  } = props;\n  const tableClasses = useTableStyles();\n\n  const theme = useTheme();\n\n  const calculatedInitialState = { ...defaultInitialState, ...initialState };\n\n  const [filtersOpen, setFiltersOpen] = useState(\n    calculatedInitialState.filtersOpen,\n  );\n  const toggleFilters = useCallback(\n    () => setFiltersOpen(v => !v),\n    [setFiltersOpen],\n  );\n\n  const [selectedFilters, setSelectedFilters] = useState(\n    calculatedInitialState.filters,\n  );\n\n  const [search, setSearch] = useState(calculatedInitialState.search);\n\n  useEffect(() => {\n    if (onStateChange) {\n      const state = removeDefaultValues(\n        {\n          search,\n          filtersOpen,\n          filters: selectedFilters,\n        },\n        defaultInitialState,\n      );\n\n      onStateChange(state);\n    }\n  }, [search, filtersOpen, selectedFilters, onStateChange]);\n\n  const getFieldByTitle = useCallback(\n    (titleValue: string | keyof T) =>\n      columns.find(el => el.title === titleValue)?.field,\n    [columns],\n  );\n\n  const tableData = useMemo(() => {\n    if (typeof data === 'function' || !selectedFilters) {\n      return data;\n    }\n\n    const selectedFiltersArray = Object.values(selectedFilters);\n    if (data && selectedFiltersArray.flat().length) {\n      const newData = (data as any[]).filter(\n        el =>\n          !!Object.entries(selectedFilters)\n            .filter(([, value]) => !!(value as { length?: number }).length)\n            .every(([key, filterValue]) => {\n              const fieldValue = extractValueByField(\n                el,\n                getFieldByTitle(key) as string,\n              );\n\n              if (Array.isArray(fieldValue) && Array.isArray(filterValue)) {\n                return fieldValue.some(v => filterValue.includes(v));\n              } else if (Array.isArray(fieldValue)) {\n                return fieldValue.includes(filterValue);\n              } else if (Array.isArray(filterValue)) {\n                return filterValue.includes(fieldValue);\n              }\n\n              return fieldValue === filterValue;\n            }),\n      );\n      return newData;\n    }\n    return data;\n  }, [data, selectedFilters, getFieldByTitle]);\n\n  const selectedFiltersLength = Object.values(selectedFilters).flat().length;\n\n  const hasFilters = !!filters?.length;\n  const Toolbar = useCallback(\n    (toolbarProps: any /* no type for this in material-table */) => {\n      return (\n        <TableToolbar\n          setSearch={setSearch}\n          hasFilters={hasFilters}\n          selectedFiltersLength={selectedFiltersLength}\n          toggleFilters={toggleFilters}\n          {...toolbarProps}\n        />\n      );\n    },\n    [toggleFilters, hasFilters, selectedFiltersLength, setSearch],\n  );\n\n  const hasNoRows = typeof data !== 'function' && data.length === 0;\n  const columnCount = columns.length;\n  const Body = useMemo(\n    () => makeBody({ hasNoRows, emptyContent, columnCount, loading }),\n    [hasNoRows, emptyContent, columnCount, loading],\n  );\n\n  return (\n    <Box className={tableClasses.root}>\n      {filtersOpen && data && typeof data !== 'function' && filters?.length && (\n        <Filters\n          filters={constructFilters(filters, data as any[], columns)}\n          selectedFilters={selectedFilters}\n          onChangeFilters={setSelectedFilters}\n        />\n      )}\n      <MTable<T>\n        components={{\n          Header: StyledMTableHeader,\n          Body,\n          Toolbar,\n          ...components,\n        }}\n        options={options}\n        columns={convertColumns(columns, theme)}\n        icons={tableIcons}\n        title={\n          <>\n            <Typography variant=\"h5\" component=\"h2\">\n              {title}\n            </Typography>\n            {subtitle && (\n              <Typography color=\"textSecondary\" variant=\"body1\">\n                {subtitle}\n              </Typography>\n            )}\n          </>\n        }\n        data={tableData}\n        style={{ width: '100%', ...style }}\n        localization={{\n          toolbar: { searchPlaceholder: 'Search', searchTooltip: 'Search' },\n          ...localization,\n        }}\n        {...restProps}\n      />\n    </Box>\n  );\n}\n\nTable.icons = Object.freeze(tableIcons);\n\nfunction makeBody({\n  columnCount,\n  emptyContent,\n  hasNoRows,\n  loading,\n}: {\n  hasNoRows: boolean;\n  emptyContent: ReactNode;\n  columnCount: number;\n  loading?: boolean;\n}) {\n  return (bodyProps: any /* no type for this in material-table */) => {\n    if (loading) {\n      return <TableLoadingBody colSpan={columnCount} />;\n    }\n\n    if (emptyContent && hasNoRows) {\n      return (\n        <tbody>\n          <tr>\n            <td colSpan={columnCount}>{emptyContent}</td>\n          </tr>\n        </tbody>\n      );\n    }\n\n    return <MTableBody {...bodyProps} />;\n  };\n}\n\nfunction constructFilters<T extends object>(\n  filterConfig: TableFilter[],\n  dataValue: any[] | undefined,\n  columns: TableColumn<T>[],\n): Filter[] {\n  const extractDistinctValues = (field: string | keyof T): Set<any> => {\n    const distinctValues = new Set<any>();\n    const addValue = (value: any) => {\n      if (value !== undefined && value !== null) {\n        distinctValues.add(value);\n      }\n    };\n\n    if (dataValue) {\n      dataValue.forEach(el => {\n        const value = extractValueByField(\n          el,\n          columns.find(c => c.title === field)?.field as string,\n        );\n\n        if (Array.isArray(value)) {\n          (value as []).forEach(addValue);\n        } else {\n          addValue(value);\n        }\n      });\n    }\n\n    return distinctValues;\n  };\n\n  const constructSelect = (\n    filter: TableFilter,\n  ): Without<SelectProps, 'onChange'> => {\n    return {\n      placeholder: 'All results',\n      label: filter.column,\n      multiple: filter.type === 'multiple-select',\n      items: [...extractDistinctValues(filter.column)].sort().map(value => ({\n        label: value,\n        value,\n      })),\n    };\n  };\n\n  return filterConfig.map(filter => ({\n    type: filter.type,\n    element: constructSelect(filter),\n  }));\n}\n"],"names":["ChevronLeft","React"],"mappings":"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"}