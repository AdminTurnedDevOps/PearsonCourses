{"version":3,"file":"ProxiedSignInPage.esm.js","sources":["../../../src/layout/ProxiedSignInPage/ProxiedSignInPage.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  discoveryApiRef,\n  SignInPageProps,\n  useApi,\n} from '@backstage/core-plugin-api';\nimport React, { ComponentType } from 'react';\nimport { useAsync, useMountEffect } from '@react-hookz/web';\nimport { ErrorPanel } from '../../components/ErrorPanel';\nimport { Progress } from '../../components/Progress';\nimport { ProxiedSignInIdentity } from './ProxiedSignInIdentity';\nimport { coreComponentsTranslationRef } from '../../translation';\nimport { useTranslationRef } from '@backstage/core-plugin-api/alpha';\n\n/**\n * Props for {@link ProxiedSignInPage}.\n *\n * @public\n */\nexport type ProxiedSignInPageProps = SignInPageProps & {\n  /**\n   * The provider to use, e.g. \"gcpIap\" or \"awsalb\". This must correspond to\n   * a properly configured auth provider ID in the auth backend.\n   */\n  provider: string;\n\n  /**\n   * Optional headers which are passed along with the request to the\n   * underlying provider\n   */\n  headers?: HeadersInit | (() => HeadersInit) | (() => Promise<HeadersInit>);\n\n  /**\n   * Error component to be rendered instead of the default error panel in case\n   * sign in fails.\n   */\n  ErrorComponent?: ComponentType<{ error?: Error }>;\n};\n\n/**\n * A sign-in page that has no user interface of its own. Instead, it relies on\n * sign-in being performed by a reverse authenticating proxy that Backstage is\n * deployed behind, and leverages its session handling.\n *\n * @remarks\n *\n * This sign-in page is useful when you are using products such as Google\n * Identity-Aware Proxy or AWS Application Load Balancer or similar, to front\n * your Backstage installation. This sign-in page implementation will silently\n * and regularly punch through the proxy to the auth backend to refresh your\n * frontend session information, without requiring user interaction.\n *\n * @public\n */\nexport const ProxiedSignInPage = (props: ProxiedSignInPageProps) => {\n  const discoveryApi = useApi(discoveryApiRef);\n  const { t } = useTranslationRef(coreComponentsTranslationRef);\n\n  const [{ status, error }, { execute }] = useAsync(async () => {\n    const identity = new ProxiedSignInIdentity({\n      provider: props.provider,\n      discoveryApi,\n      headers: props.headers,\n    });\n\n    await identity.start();\n\n    props.onSignInSuccess(identity);\n  });\n\n  useMountEffect(execute);\n\n  if (status === 'loading') {\n    return <Progress />;\n  } else if (error) {\n    return props.ErrorComponent ? (\n      <props.ErrorComponent error={error} />\n    ) : (\n      <ErrorPanel title={t('proxiedSignInPage.title')} error={error} />\n    );\n  }\n\n  return null;\n};\n"],"names":["React"],"mappings":";;;;;;;;;AAqEa,MAAA,iBAAA,GAAoB,CAAC,KAAkC,KAAA;AAClE,EAAM,MAAA,YAAA,GAAe,OAAO,eAAe,CAAA;AAC3C,EAAA,MAAM,EAAE,CAAA,EAAM,GAAA,iBAAA,CAAkB,4BAA4B,CAAA;AAE5D,EAAM,MAAA,CAAC,EAAE,MAAA,EAAQ,KAAM,EAAA,EAAG,EAAE,OAAQ,EAAC,CAAI,GAAA,QAAA,CAAS,YAAY;AAC5D,IAAM,MAAA,QAAA,GAAW,IAAI,qBAAsB,CAAA;AAAA,MACzC,UAAU,KAAM,CAAA,QAAA;AAAA,MAChB,YAAA;AAAA,MACA,SAAS,KAAM,CAAA;AAAA,KAChB,CAAA;AAED,IAAA,MAAM,SAAS,KAAM,EAAA;AAErB,IAAA,KAAA,CAAM,gBAAgB,QAAQ,CAAA;AAAA,GAC/B,CAAA;AAED,EAAA,cAAA,CAAe,OAAO,CAAA;AAEtB,EAAA,IAAI,WAAW,SAAW,EAAA;AACxB,IAAA,oDAAQ,QAAS,EAAA,IAAA,CAAA;AAAA,aACR,KAAO,EAAA;AAChB,IAAA,OAAO,KAAM,CAAA,cAAA,mBACVA,cAAA,CAAA,aAAA,CAAA,KAAA,CAAM,gBAAN,EAAqB,KAAA,EAAc,CAEpC,mBAAAA,cAAA,CAAA,aAAA,CAAC,UAAW,EAAA,EAAA,KAAA,EAAO,CAAE,CAAA,yBAAyB,GAAG,KAAc,EAAA,CAAA;AAAA;AAInE,EAAO,OAAA,IAAA;AACT;;;;"}