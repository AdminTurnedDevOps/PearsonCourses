{"version":3,"file":"ErrorBoundary.esm.js","sources":["../../../src/layout/ErrorBoundary/ErrorBoundary.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Typography from '@material-ui/core/Typography';\nimport React, { ComponentClass, Component, ErrorInfo } from 'react';\nimport { LinkButton } from '../../components/LinkButton';\nimport { ErrorPanel } from '../../components/ErrorPanel';\nimport { coreComponentsTranslationRef } from '../../translation';\nimport { useTranslationRef } from '@backstage/core-plugin-api/alpha';\n\ntype SlackChannel = {\n  name: string;\n  href?: string;\n};\n\n/** @public */\nexport type ErrorBoundaryProps = React.PropsWithChildren<{\n  slackChannel?: string | SlackChannel;\n  onError?: (error: Error, errorInfo: string) => null;\n}>;\n\ntype State = {\n  error?: Error;\n  errorInfo?: ErrorInfo;\n};\n\nconst SlackLink = (props: { slackChannel?: string | SlackChannel }) => {\n  const { slackChannel } = props;\n  const { t } = useTranslationRef(coreComponentsTranslationRef);\n\n  if (!slackChannel) {\n    return null;\n  } else if (typeof slackChannel === 'string') {\n    return (\n      <Typography>{t('errorBoundary.title', { slackChannel })}</Typography>\n    );\n  } else if (!slackChannel.href) {\n    return (\n      <Typography>\n        {t('errorBoundary.title', {\n          slackChannel: slackChannel.name,\n        })}\n      </Typography>\n    );\n  }\n\n  return (\n    <LinkButton to={slackChannel.href} variant=\"contained\">\n      {slackChannel.name}\n    </LinkButton>\n  );\n};\n\n/** @public */\nexport const ErrorBoundary: ComponentClass<\n  ErrorBoundaryProps,\n  State\n> = class ErrorBoundary extends Component<ErrorBoundaryProps, State> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = {\n      error: undefined,\n      errorInfo: undefined,\n    };\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    // eslint-disable-next-line no-console\n    console.error(`ErrorBoundary, error: ${error}`, { error, errorInfo });\n    this.setState({ error, errorInfo });\n  }\n\n  render() {\n    const { slackChannel, children } = this.props;\n    const { error } = this.state;\n\n    if (!error) {\n      return children;\n    }\n\n    return (\n      <ErrorPanel title=\"Something Went Wrong\" error={error}>\n        <SlackLink slackChannel={slackChannel} />\n      </ErrorPanel>\n    );\n  }\n};\n"],"names":["React","ErrorBoundary"],"mappings":";;;;;;;AAuCA,MAAM,SAAA,GAAY,CAAC,KAAoD,KAAA;AACrE,EAAM,MAAA,EAAE,cAAiB,GAAA,KAAA;AACzB,EAAA,MAAM,EAAE,CAAA,EAAM,GAAA,iBAAA,CAAkB,4BAA4B,CAAA;AAE5D,EAAA,IAAI,CAAC,YAAc,EAAA;AACjB,IAAO,OAAA,IAAA;AAAA,GACT,MAAA,IAAW,OAAO,YAAA,KAAiB,QAAU,EAAA;AAC3C,IAAA,oDACG,UAAY,EAAA,IAAA,EAAA,CAAA,CAAE,uBAAuB,EAAE,YAAA,EAAc,CAAE,CAAA;AAAA,GAE5D,MAAA,IAAW,CAAC,YAAA,CAAa,IAAM,EAAA;AAC7B,IACE,uBAAAA,cAAA,CAAA,aAAA,CAAC,UACE,EAAA,IAAA,EAAA,CAAA,CAAE,qBAAuB,EAAA;AAAA,MACxB,cAAc,YAAa,CAAA;AAAA,KAC5B,CACH,CAAA;AAAA;AAIJ,EACE,uBAAAA,cAAA,CAAA,aAAA,CAAC,cAAW,EAAI,EAAA,YAAA,CAAa,MAAM,OAAQ,EAAA,WAAA,EAAA,EACxC,aAAa,IAChB,CAAA;AAEJ,CAAA;AAGa,MAAA,aAAA,GAGT,MAAMC,cAAAA,SAAsB,SAAqC,CAAA;AAAA,EACnE,YAAY,KAA2B,EAAA;AACrC,IAAA,KAAA,CAAM,KAAK,CAAA;AACX,IAAA,IAAA,CAAK,KAAQ,GAAA;AAAA,MACX,KAAO,EAAA,KAAA,CAAA;AAAA,MACP,SAAW,EAAA,KAAA;AAAA,KACb;AAAA;AACF,EAEA,iBAAA,CAAkB,OAAc,SAAsB,EAAA;AAEpD,IAAA,OAAA,CAAQ,MAAM,CAAyB,sBAAA,EAAA,KAAK,IAAI,EAAE,KAAA,EAAO,WAAW,CAAA;AACpE,IAAA,IAAA,CAAK,QAAS,CAAA,EAAE,KAAO,EAAA,SAAA,EAAW,CAAA;AAAA;AACpC,EAEA,MAAS,GAAA;AACP,IAAA,MAAM,EAAE,YAAA,EAAc,QAAS,EAAA,GAAI,IAAK,CAAA,KAAA;AACxC,IAAM,MAAA,EAAE,KAAM,EAAA,GAAI,IAAK,CAAA,KAAA;AAEvB,IAAA,IAAI,CAAC,KAAO,EAAA;AACV,MAAO,OAAA,QAAA;AAAA;AAGT,IACE,uBAAAD,cAAA,CAAA,aAAA,CAAC,cAAW,KAAM,EAAA,sBAAA,EAAuB,yBACtCA,cAAA,CAAA,aAAA,CAAA,SAAA,EAAA,EAAU,cAA4B,CACzC,CAAA;AAAA;AAGN;;;;"}