{"version":3,"file":"resolve.cjs.js","sources":["../../../src/processors/codeowners/resolve.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as codeowners from 'codeowners-utils';\nimport parseGitUrl from 'git-url-parse';\n\nconst USER_PATTERN = /^@.*/;\nconst GROUP_PATTERN = /^@.*\\/.*/;\nconst EMAIL_PATTERN = /^.*@.*\\..*$/;\n\nexport function resolveCodeOwner(\n  contents: string,\n  catalogInfoFileUrl: string,\n): string | undefined {\n  const codeOwnerEntries = codeowners.parse(contents);\n\n  const { filepath } = parseGitUrl(catalogInfoFileUrl);\n  const match = codeowners.matchFile(filepath, codeOwnerEntries);\n\n  return match ? normalizeCodeOwner(match.owners[0]) : undefined;\n}\n\nexport function normalizeCodeOwner(owner: string) {\n  if (owner.match(GROUP_PATTERN)) {\n    return owner.split('/')[1];\n  } else if (owner.match(USER_PATTERN)) {\n    return `User:${owner.substring(1)}`;\n  } else if (owner.match(EMAIL_PATTERN)) {\n    return owner.split('@')[0];\n  }\n\n  return owner;\n}\n"],"names":["codeowners","parseGitUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmBA,MAAM,YAAe,GAAA,MAAA;AACrB,MAAM,aAAgB,GAAA,UAAA;AACtB,MAAM,aAAgB,GAAA,aAAA;AAEN,SAAA,gBAAA,CACd,UACA,kBACoB,EAAA;AACpB,EAAM,MAAA,gBAAA,GAAmBA,qBAAW,CAAA,KAAA,CAAM,QAAQ,CAAA;AAElD,EAAA,MAAM,EAAE,QAAA,EAAa,GAAAC,4BAAA,CAAY,kBAAkB,CAAA;AACnD,EAAA,MAAM,KAAQ,GAAAD,qBAAA,CAAW,SAAU,CAAA,QAAA,EAAU,gBAAgB,CAAA;AAE7D,EAAA,OAAO,QAAQ,kBAAmB,CAAA,KAAA,CAAM,MAAO,CAAA,CAAC,CAAC,CAAI,GAAA,KAAA,CAAA;AACvD;AAEO,SAAS,mBAAmB,KAAe,EAAA;AAChD,EAAI,IAAA,KAAA,CAAM,KAAM,CAAA,aAAa,CAAG,EAAA;AAC9B,IAAA,OAAO,KAAM,CAAA,KAAA,CAAM,GAAG,CAAA,CAAE,CAAC,CAAA;AAAA,GAChB,MAAA,IAAA,KAAA,CAAM,KAAM,CAAA,YAAY,CAAG,EAAA;AACpC,IAAA,OAAO,CAAQ,KAAA,EAAA,KAAA,CAAM,SAAU,CAAA,CAAC,CAAC,CAAA,CAAA;AAAA,GACxB,MAAA,IAAA,KAAA,CAAM,KAAM,CAAA,aAAa,CAAG,EAAA;AACrC,IAAA,OAAO,KAAM,CAAA,KAAA,CAAM,GAAG,CAAA,CAAE,CAAC,CAAA;AAAA;AAG3B,EAAO,OAAA,KAAA;AACT;;;;;"}