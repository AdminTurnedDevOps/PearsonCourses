{"version":3,"file":"isEntityOwner.cjs.js","sources":["../../../src/permissions/rules/isEntityOwner.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { RELATION_OWNED_BY } from '@backstage/catalog-model';\nimport { RESOURCE_TYPE_CATALOG_ENTITY } from '@backstage/plugin-catalog-common/alpha';\nimport { z } from 'zod';\nimport { createCatalogPermissionRule } from './util';\n\n/**\n * A catalog {@link @backstage/plugin-permission-node#PermissionRule} which\n * filters for entities with a specified owner.\n *\n * @alpha\n */\nexport const isEntityOwner = createCatalogPermissionRule({\n  name: 'IS_ENTITY_OWNER',\n  description: 'Allow entities owned by a specified claim',\n  resourceType: RESOURCE_TYPE_CATALOG_ENTITY,\n  paramsSchema: z.object({\n    claims: z\n      .array(z.string())\n      .describe(\n        `List of claims to match at least one on within ${RELATION_OWNED_BY}`,\n      ),\n  }),\n  apply: (resource, { claims }) => {\n    if (!resource.relations) {\n      return false;\n    }\n\n    return resource.relations\n      .filter(relation => relation.type === RELATION_OWNED_BY)\n      .some(relation => claims.includes(relation.targetRef));\n  },\n  toQuery: ({ claims }) => ({\n    key: 'relations.ownedBy',\n    values: claims,\n  }),\n});\n"],"names":["createCatalogPermissionRule","RESOURCE_TYPE_CATALOG_ENTITY","z","RELATION_OWNED_BY"],"mappings":";;;;;;;AA2BO,MAAM,gBAAgBA,gCAA4B,CAAA;AAAA,EACvD,IAAM,EAAA,iBAAA;AAAA,EACN,WAAa,EAAA,2CAAA;AAAA,EACb,YAAc,EAAAC,kCAAA;AAAA,EACd,YAAA,EAAcC,MAAE,MAAO,CAAA;AAAA,IACrB,QAAQA,KACL,CAAA,KAAA,CAAMA,KAAE,CAAA,MAAA,EAAQ,CAChB,CAAA,QAAA;AAAA,MACC,kDAAkDC,8BAAiB,CAAA;AAAA;AACrE,GACH,CAAA;AAAA,EACD,KAAO,EAAA,CAAC,QAAU,EAAA,EAAE,QAAa,KAAA;AAC/B,IAAI,IAAA,CAAC,SAAS,SAAW,EAAA;AACvB,MAAO,OAAA,KAAA;AAAA;AAGT,IAAA,OAAO,QAAS,CAAA,SAAA,CACb,MAAO,CAAA,CAAA,QAAA,KAAY,SAAS,IAAS,KAAAA,8BAAiB,CACtD,CAAA,IAAA,CAAK,CAAY,QAAA,KAAA,MAAA,CAAO,QAAS,CAAA,QAAA,CAAS,SAAS,CAAC,CAAA;AAAA,GACzD;AAAA,EACA,OAAS,EAAA,CAAC,EAAE,MAAA,EAAc,MAAA;AAAA,IACxB,GAAK,EAAA,mBAAA;AAAA,IACL,MAAQ,EAAA;AAAA,GACV;AACF,CAAC;;;;"}