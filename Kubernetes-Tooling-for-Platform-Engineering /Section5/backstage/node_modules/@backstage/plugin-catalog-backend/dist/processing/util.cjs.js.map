{"version":3,"file":"util.cjs.js","sources":["../../src/processing/util.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  entityEnvelopeSchemaValidator,\n  entitySchemaValidator,\n  LocationEntity,\n  ANNOTATION_LOCATION,\n  ANNOTATION_ORIGIN_LOCATION,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport { JsonObject, JsonValue } from '@backstage/types';\nimport { InputError } from '@backstage/errors';\nimport { ScmIntegrationRegistry } from '@backstage/integration';\nimport path from 'path';\nimport { LocationSpec } from '@backstage/plugin-catalog-common';\n\nexport function isLocationEntity(entity: Entity): entity is LocationEntity {\n  return entity.kind === 'Location';\n}\n\nexport function getEntityLocationRef(entity: Entity): string {\n  const ref = entity.metadata.annotations?.[ANNOTATION_LOCATION];\n  if (!ref) {\n    const entityRef = stringifyEntityRef(entity);\n    throw new InputError(\n      `Entity '${entityRef}' does not have the annotation ${ANNOTATION_LOCATION}`,\n    );\n  }\n  return ref;\n}\n\nexport function getEntityOriginLocationRef(entity: Entity): string {\n  const ref = entity.metadata.annotations?.[ANNOTATION_ORIGIN_LOCATION];\n  if (!ref) {\n    const entityRef = stringifyEntityRef(entity);\n    throw new InputError(\n      `Entity '${entityRef}' does not have the annotation ${ANNOTATION_ORIGIN_LOCATION}`,\n    );\n  }\n  return ref;\n}\n\nexport function toAbsoluteUrl(\n  integrations: ScmIntegrationRegistry,\n  base: LocationSpec,\n  type: string,\n  target: string,\n): string {\n  if (base.type !== type) {\n    return target;\n  }\n  try {\n    if (type === 'file') {\n      if (target.startsWith('.')) {\n        return path.join(path.dirname(base.target), target);\n      }\n      return target;\n    } else if (type === 'url') {\n      return integrations.resolveUrl({ url: target, base: base.target });\n    }\n    return target;\n  } catch (e) {\n    return target;\n  }\n}\n\nexport function isObject(value: JsonValue | undefined): value is JsonObject {\n  return typeof value === 'object' && value !== null && !Array.isArray(value);\n}\n\nexport const validateEntity = entitySchemaValidator();\n\nexport const validateEntityEnvelope = entityEnvelopeSchemaValidator();\n"],"names":["ANNOTATION_LOCATION","stringifyEntityRef","InputError","ANNOTATION_ORIGIN_LOCATION","path","entitySchemaValidator","entityEnvelopeSchemaValidator"],"mappings":";;;;;;;;;;AA+BO,SAAS,iBAAiB,MAA0C,EAAA;AACzE,EAAA,OAAO,OAAO,IAAS,KAAA,UAAA;AACzB;AAEO,SAAS,qBAAqB,MAAwB,EAAA;AAC3D,EAAA,MAAM,GAAM,GAAA,MAAA,CAAO,QAAS,CAAA,WAAA,GAAcA,gCAAmB,CAAA;AAC7D,EAAA,IAAI,CAAC,GAAK,EAAA;AACR,IAAM,MAAA,SAAA,GAAYC,gCAAmB,MAAM,CAAA;AAC3C,IAAA,MAAM,IAAIC,iBAAA;AAAA,MACR,CAAA,QAAA,EAAW,SAAS,CAAA,+BAAA,EAAkCF,gCAAmB,CAAA;AAAA,KAC3E;AAAA;AAEF,EAAO,OAAA,GAAA;AACT;AAEO,SAAS,2BAA2B,MAAwB,EAAA;AACjE,EAAA,MAAM,GAAM,GAAA,MAAA,CAAO,QAAS,CAAA,WAAA,GAAcG,uCAA0B,CAAA;AACpE,EAAA,IAAI,CAAC,GAAK,EAAA;AACR,IAAM,MAAA,SAAA,GAAYF,gCAAmB,MAAM,CAAA;AAC3C,IAAA,MAAM,IAAIC,iBAAA;AAAA,MACR,CAAA,QAAA,EAAW,SAAS,CAAA,+BAAA,EAAkCC,uCAA0B,CAAA;AAAA,KAClF;AAAA;AAEF,EAAO,OAAA,GAAA;AACT;AAEO,SAAS,aACd,CAAA,YAAA,EACA,IACA,EAAA,IAAA,EACA,MACQ,EAAA;AACR,EAAI,IAAA,IAAA,CAAK,SAAS,IAAM,EAAA;AACtB,IAAO,OAAA,MAAA;AAAA;AAET,EAAI,IAAA;AACF,IAAA,IAAI,SAAS,MAAQ,EAAA;AACnB,MAAI,IAAA,MAAA,CAAO,UAAW,CAAA,GAAG,CAAG,EAAA;AAC1B,QAAA,OAAOC,sBAAK,IAAK,CAAAA,qBAAA,CAAK,QAAQ,IAAK,CAAA,MAAM,GAAG,MAAM,CAAA;AAAA;AAEpD,MAAO,OAAA,MAAA;AAAA,KACT,MAAA,IAAW,SAAS,KAAO,EAAA;AACzB,MAAO,OAAA,YAAA,CAAa,WAAW,EAAE,GAAA,EAAK,QAAQ,IAAM,EAAA,IAAA,CAAK,QAAQ,CAAA;AAAA;AAEnE,IAAO,OAAA,MAAA;AAAA,WACA,CAAG,EAAA;AACV,IAAO,OAAA,MAAA;AAAA;AAEX;AAEO,SAAS,SAAS,KAAmD,EAAA;AAC1E,EAAO,OAAA,OAAO,UAAU,QAAY,IAAA,KAAA,KAAU,QAAQ,CAAC,KAAA,CAAM,QAAQ,KAAK,CAAA;AAC5E;AAEO,MAAM,iBAAiBC,kCAAsB;AAE7C,MAAM,yBAAyBC,0CAA8B;;;;;;;;;;"}