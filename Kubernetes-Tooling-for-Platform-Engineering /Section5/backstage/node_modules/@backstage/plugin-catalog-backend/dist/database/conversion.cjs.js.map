{"version":3,"file":"conversion.cjs.js","sources":["../../src/database/conversion.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isDatabaseConflictError } from '@backstage/backend-plugin-api';\nimport { ConflictError, InputError } from '@backstage/errors';\nimport { DateTime } from 'luxon';\n\n/**\n * Takes a TIMESTAMP type column and converts it to a DateTime.\n *\n * Some engines return the SQL string form (e.g. 'YYYY-MM-DD hh:mm:ss'), some\n * return ISO string form (e.g. 'YYYY-MM-DDThh:mm:ss.SSSZ'), some return a js\n * Date object.\n */\nexport function timestampToDateTime(input: Date | string): DateTime {\n  try {\n    if (typeof input === 'object') {\n      return DateTime.fromJSDate(input).toUTC();\n    }\n\n    const result = input.includes(' ')\n      ? DateTime.fromSQL(input, { zone: 'utc' })\n      : DateTime.fromISO(input, { zone: 'utc' });\n    if (!result.isValid) {\n      throw new TypeError('Not valid');\n    }\n\n    return result;\n  } catch (e) {\n    throw new InputError(`Failed to parse database timestamp ${input}`, e);\n  }\n}\n\n/**\n * Rethrows an error, possibly translating it to a more precise error type.\n */\nexport function rethrowError(e: any): never {\n  if (isDatabaseConflictError(e)) {\n    throw new ConflictError(`Rejected due to a conflicting entity`, e);\n  }\n\n  throw e;\n}\n"],"names":["DateTime","InputError","isDatabaseConflictError","ConflictError"],"mappings":";;;;;;AA2BO,SAAS,oBAAoB,KAAgC,EAAA;AAClE,EAAI,IAAA;AACF,IAAI,IAAA,OAAO,UAAU,QAAU,EAAA;AAC7B,MAAA,OAAOA,cAAS,CAAA,UAAA,CAAW,KAAK,CAAA,CAAE,KAAM,EAAA;AAAA;AAG1C,IAAA,MAAM,SAAS,KAAM,CAAA,QAAA,CAAS,GAAG,CAC7B,GAAAA,cAAA,CAAS,QAAQ,KAAO,EAAA,EAAE,MAAM,KAAM,EAAC,IACvCA,cAAS,CAAA,OAAA,CAAQ,OAAO,EAAE,IAAA,EAAM,OAAO,CAAA;AAC3C,IAAI,IAAA,CAAC,OAAO,OAAS,EAAA;AACnB,MAAM,MAAA,IAAI,UAAU,WAAW,CAAA;AAAA;AAGjC,IAAO,OAAA,MAAA;AAAA,WACA,CAAG,EAAA;AACV,IAAA,MAAM,IAAIC,iBAAA,CAAW,CAAsC,mCAAA,EAAA,KAAK,IAAI,CAAC,CAAA;AAAA;AAEzE;AAKO,SAAS,aAAa,CAAe,EAAA;AAC1C,EAAI,IAAAC,wCAAA,CAAwB,CAAC,CAAG,EAAA;AAC9B,IAAM,MAAA,IAAIC,oBAAc,CAAA,CAAA,oCAAA,CAAA,EAAwC,CAAC,CAAA;AAAA;AAGnE,EAAM,MAAA,CAAA;AACR;;;;;"}