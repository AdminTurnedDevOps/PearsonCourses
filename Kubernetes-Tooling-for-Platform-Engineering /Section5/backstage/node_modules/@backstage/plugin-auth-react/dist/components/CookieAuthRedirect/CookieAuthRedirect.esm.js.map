{"version":3,"file":"CookieAuthRedirect.esm.js","sources":["../../../src/components/CookieAuthRedirect/CookieAuthRedirect.tsx"],"sourcesContent":["/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { identityApiRef, useApi } from '@backstage/core-plugin-api';\nimport { useAsync, useMountEffect } from '@react-hookz/web';\n\n/**\n * @public\n * A component that redirects to the page an user was trying to access before sign-in.\n */\nexport function CookieAuthRedirect() {\n  const identityApi = useApi(identityApiRef);\n\n  const [state, actions] = useAsync(async () => {\n    const { token } = await identityApi.getCredentials();\n    if (!token) {\n      throw new Error('Expected Backstage token in sign-in response');\n    }\n    return token;\n  });\n\n  useMountEffect(actions.execute);\n\n  if (state.status === 'error' && state.error) {\n    return <>An error occurred: {state.error.message}</>;\n  }\n\n  if (state.status === 'success' && state.result) {\n    return (\n      <form\n        ref={form => form?.submit()}\n        action={window.location.href}\n        method=\"POST\"\n        style={{ visibility: 'hidden' }}\n      >\n        <input type=\"hidden\" name=\"type\" value=\"sign-in\" />\n        <input type=\"hidden\" name=\"token\" value={state.result} />\n        <input type=\"submit\" value=\"Continue\" />\n      </form>\n    );\n  }\n\n  return null;\n}\n"],"names":[],"mappings":";;;;AAwBO,SAAS,kBAAqB,GAAA;AACnC,EAAM,MAAA,WAAA,GAAc,OAAO,cAAc,CAAA;AAEzC,EAAA,MAAM,CAAC,KAAA,EAAO,OAAO,CAAA,GAAI,SAAS,YAAY;AAC5C,IAAA,MAAM,EAAE,KAAA,EAAU,GAAA,MAAM,YAAY,cAAe,EAAA;AACnD,IAAA,IAAI,CAAC,KAAO,EAAA;AACV,MAAM,MAAA,IAAI,MAAM,8CAA8C,CAAA;AAAA;AAEhE,IAAO,OAAA,KAAA;AAAA,GACR,CAAA;AAED,EAAA,cAAA,CAAe,QAAQ,OAAO,CAAA;AAE9B,EAAA,IAAI,KAAM,CAAA,MAAA,KAAW,OAAW,IAAA,KAAA,CAAM,KAAO,EAAA;AAC3C,IAAA,uBAAS,KAAA,CAAA,aAAA,CAAA,KAAA,CAAA,QAAA,EAAA,IAAA,EAAA,qBAAA,EAAoB,KAAM,CAAA,KAAA,CAAM,OAAQ,CAAA;AAAA;AAGnD,EAAA,IAAI,KAAM,CAAA,MAAA,KAAW,SAAa,IAAA,KAAA,CAAM,MAAQ,EAAA;AAC9C,IACE,uBAAA,KAAA,CAAA,aAAA;AAAA,MAAC,MAAA;AAAA,MAAA;AAAA,QACC,GAAA,EAAK,CAAQ,IAAA,KAAA,IAAA,EAAM,MAAO,EAAA;AAAA,QAC1B,MAAA,EAAQ,OAAO,QAAS,CAAA,IAAA;AAAA,QACxB,MAAO,EAAA,MAAA;AAAA,QACP,KAAA,EAAO,EAAE,UAAA,EAAY,QAAS;AAAA,OAAA;AAAA,0CAE7B,OAAM,EAAA,EAAA,IAAA,EAAK,UAAS,IAAK,EAAA,MAAA,EAAO,OAAM,SAAU,EAAA,CAAA;AAAA,sBACjD,KAAA,CAAA,aAAA,CAAC,WAAM,IAAK,EAAA,QAAA,EAAS,MAAK,OAAQ,EAAA,KAAA,EAAO,MAAM,MAAQ,EAAA,CAAA;AAAA,sBACtD,KAAA,CAAA,aAAA,CAAA,OAAA,EAAA,EAAM,IAAK,EAAA,QAAA,EAAS,OAAM,UAAW,EAAA;AAAA,KACxC;AAAA;AAIJ,EAAO,OAAA,IAAA;AACT;;;;"}