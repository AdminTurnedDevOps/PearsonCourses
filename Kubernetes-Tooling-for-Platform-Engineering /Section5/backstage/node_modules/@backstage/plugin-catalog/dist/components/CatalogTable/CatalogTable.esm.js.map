{"version":3,"file":"CatalogTable.esm.js","sources":["../../../src/components/CatalogTable/CatalogTable.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  ANNOTATION_EDIT_URL,\n  ANNOTATION_VIEW_URL,\n  Entity,\n  RELATION_OWNED_BY,\n  RELATION_PART_OF,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport {\n  CodeSnippet,\n  Table,\n  TableColumn,\n  TableProps,\n  WarningPanel,\n} from '@backstage/core-components';\nimport {\n  getEntityRelations,\n  humanizeEntityRef,\n  useEntityList,\n  useStarredEntities,\n} from '@backstage/plugin-catalog-react';\nimport Typography from '@material-ui/core/Typography';\nimport { visuallyHidden } from '@mui/utils';\nimport Edit from '@material-ui/icons/Edit';\nimport OpenInNew from '@material-ui/icons/OpenInNew';\nimport { capitalize } from 'lodash';\nimport pluralize from 'pluralize';\nimport React, { ReactNode, useMemo } from 'react';\nimport { columnFactories } from './columns';\nimport { CatalogTableColumnsFunc, CatalogTableRow } from './types';\nimport { OffsetPaginatedCatalogTable } from './OffsetPaginatedCatalogTable';\nimport { CursorPaginatedCatalogTable } from './CursorPaginatedCatalogTable';\nimport { defaultCatalogTableColumnsFunc } from './defaultCatalogTableColumnsFunc';\nimport { useTranslationRef } from '@backstage/core-plugin-api/alpha';\nimport { catalogTranslationRef } from '../../alpha/translation';\nimport { FavoriteToggleIcon } from '@backstage/core-components';\nimport { CatalogTableToolbar } from './CatalogTableToolbar';\n\n/**\n * Props for {@link CatalogTable}.\n *\n * @public\n */\nexport interface CatalogTableProps {\n  columns?: TableColumn<CatalogTableRow>[] | CatalogTableColumnsFunc;\n  actions?: TableProps<CatalogTableRow>['actions'];\n  tableOptions?: TableProps<CatalogTableRow>['options'];\n  emptyContent?: ReactNode;\n  /**\n   * A static title to use for the table. If not provided, a title will be\n   * generated based on the current Kind and Type filters and total number of items.\n   */\n  title?: string;\n  subtitle?: string;\n}\n\nconst refCompare = (a: Entity, b: Entity) => {\n  const toRef = (entity: Entity) =>\n    entity.metadata.title ||\n    humanizeEntityRef(entity, {\n      defaultKind: 'Component',\n    });\n\n  return toRef(a).localeCompare(toRef(b));\n};\n\n/**\n * CatalogTable is a wrapper around the Table component that is pre-configured\n * to display catalog entities.\n *\n * @remarks\n *\n * See {@link https://backstage.io/docs/features/software-catalog/catalog-customization}\n *\n * @public\n */\nexport const CatalogTable = (props: CatalogTableProps) => {\n  const {\n    columns = defaultCatalogTableColumnsFunc,\n    tableOptions,\n    subtitle,\n    emptyContent,\n  } = props;\n  const { isStarredEntity, toggleStarredEntity } = useStarredEntities();\n  const entityListContext = useEntityList();\n\n  const {\n    loading,\n    error,\n    entities,\n    filters,\n    pageInfo,\n    totalItems,\n    paginationMode,\n  } = entityListContext;\n\n  const tableColumns = useMemo(\n    () =>\n      typeof columns === 'function' ? columns(entityListContext) : columns,\n    [columns, entityListContext],\n  );\n  const { t } = useTranslationRef(catalogTranslationRef);\n\n  if (error) {\n    return (\n      <div>\n        <WarningPanel\n          severity=\"error\"\n          title={t('catalogTable.warningPanelTitle')}\n        >\n          <CodeSnippet language=\"text\" text={error.toString()} />\n        </WarningPanel>\n      </div>\n    );\n  }\n\n  const defaultActions: TableProps<CatalogTableRow>['actions'] = [\n    ({ entity }) => {\n      const url = entity.metadata.annotations?.[ANNOTATION_VIEW_URL];\n      const title = t('catalogTable.viewActionTitle');\n\n      return {\n        icon: () => (\n          <>\n            <Typography style={visuallyHidden}>{title}</Typography>\n            <OpenInNew fontSize=\"small\" />\n          </>\n        ),\n        tooltip: title,\n        disabled: !url,\n        onClick: () => {\n          if (!url) return;\n          window.open(url, '_blank');\n        },\n      };\n    },\n    ({ entity }) => {\n      const url = entity.metadata.annotations?.[ANNOTATION_EDIT_URL];\n      const title = t('catalogTable.editActionTitle');\n\n      return {\n        icon: () => (\n          <>\n            <Typography style={visuallyHidden}>{title}</Typography>\n            <Edit fontSize=\"small\" />\n          </>\n        ),\n        tooltip: title,\n        disabled: !url,\n        onClick: () => {\n          if (!url) return;\n          window.open(url, '_blank');\n        },\n      };\n    },\n    ({ entity }) => {\n      const isStarred = isStarredEntity(entity);\n      const title = isStarred\n        ? t('catalogTable.unStarActionTitle')\n        : t('catalogTable.starActionTitle');\n\n      return {\n        cellStyle: { paddingLeft: '1em' },\n        icon: () => <FavoriteToggleIcon isFavorite={isStarred} />,\n        tooltip: title,\n        onClick: () => toggleStarredEntity(entity),\n      };\n    },\n  ];\n\n  const currentKind = filters.kind?.label || '';\n  const currentType = filters.type?.value || '';\n  const currentCount = typeof totalItems === 'number' ? `(${totalItems})` : '';\n  // TODO(timbonicus): remove the title from the CatalogTable once using EntitySearchBar\n  const titlePreamble = capitalize(filters.user?.value ?? 'all');\n  const title =\n    props.title ||\n    [titlePreamble, currentType, pluralize(currentKind), currentCount]\n      .filter(s => s)\n      .join(' ');\n\n  const actions = props.actions || defaultActions;\n  const options = {\n    actionsColumnIndex: -1,\n    loadingType: 'linear' as const,\n    showEmptyDataSourceMessage: !loading,\n    padding: 'dense' as const,\n    ...tableOptions,\n  };\n\n  if (paginationMode === 'cursor') {\n    return (\n      <CursorPaginatedCatalogTable\n        columns={tableColumns}\n        emptyContent={emptyContent}\n        isLoading={loading}\n        title={title}\n        actions={actions}\n        subtitle={subtitle}\n        options={options}\n        data={entities.map(toEntityRow)}\n        next={pageInfo?.next}\n        prev={pageInfo?.prev}\n      />\n    );\n  } else if (paginationMode === 'offset') {\n    return (\n      <OffsetPaginatedCatalogTable\n        columns={tableColumns}\n        emptyContent={emptyContent}\n        isLoading={loading}\n        title={title}\n        actions={actions}\n        subtitle={subtitle}\n        options={options}\n        data={entities.map(toEntityRow)}\n      />\n    );\n  }\n\n  const rows = entities.sort(refCompare).map(toEntityRow);\n  const pageSize = 20;\n  const showPagination = rows.length > pageSize;\n\n  return (\n    <Table<CatalogTableRow>\n      isLoading={loading}\n      columns={tableColumns}\n      options={{\n        paging: showPagination,\n        pageSize: pageSize,\n        pageSizeOptions: [20, 50, 100],\n        ...options,\n      }}\n      components={{\n        Toolbar: CatalogTableToolbar,\n      }}\n      title={title}\n      data={rows}\n      actions={actions}\n      subtitle={subtitle}\n      emptyContent={emptyContent}\n    />\n  );\n};\n\nCatalogTable.columns = columnFactories;\nCatalogTable.defaultColumnsFunc = defaultCatalogTableColumnsFunc;\n\nfunction toEntityRow(entity: Entity) {\n  const partOfSystemRelations = getEntityRelations(entity, RELATION_PART_OF, {\n    kind: 'system',\n  });\n  const ownedByRelations = getEntityRelations(entity, RELATION_OWNED_BY);\n\n  return {\n    entity,\n    resolved: {\n      // This name is here for backwards compatibility mostly; the\n      // presentation of refs in the table should in general be handled with\n      // EntityRefLink / EntityName components\n      name: humanizeEntityRef(entity, {\n        defaultKind: 'Component',\n      }),\n      entityRef: stringifyEntityRef(entity),\n      ownedByRelationsTitle: ownedByRelations\n        .map(r => humanizeEntityRef(r, { defaultKind: 'group' }))\n        .join(', '),\n      ownedByRelations,\n      partOfSystemRelationTitle: partOfSystemRelations\n        .map(r =>\n          humanizeEntityRef(r, {\n            defaultKind: 'system',\n          }),\n        )\n        .join(', '),\n      partOfSystemRelations,\n    },\n  };\n}\n"],"names":["title","Edit"],"mappings":"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"}