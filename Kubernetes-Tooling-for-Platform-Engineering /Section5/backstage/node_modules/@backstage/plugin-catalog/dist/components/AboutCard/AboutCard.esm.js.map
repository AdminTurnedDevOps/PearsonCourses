{"version":3,"file":"AboutCard.esm.js","sources":["../../../src/components/AboutCard/AboutCard.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  ANNOTATION_EDIT_URL,\n  ANNOTATION_LOCATION,\n  CompoundEntityRef,\n  DEFAULT_NAMESPACE,\n  stringifyEntityRef,\n  parseEntityRef,\n} from '@backstage/catalog-model';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/CardContent';\nimport CardHeader from '@material-ui/core/CardHeader';\nimport Divider from '@material-ui/core/Divider';\nimport IconButton from '@material-ui/core/IconButton';\nimport { makeStyles } from '@material-ui/core/styles';\nimport {\n  AppIcon,\n  HeaderIconLinkRow,\n  IconLinkVerticalProps,\n  InfoCardVariants,\n  Link,\n} from '@backstage/core-components';\nimport React, { useCallback } from 'react';\nimport {\n  ScmIntegrationIcon,\n  scmIntegrationsApiRef,\n} from '@backstage/integration-react';\nimport {\n  alertApiRef,\n  errorApiRef,\n  useApi,\n  useApp,\n  useRouteRef,\n} from '@backstage/core-plugin-api';\nimport {\n  catalogApiRef,\n  getEntitySourceLocation,\n  useEntity,\n} from '@backstage/plugin-catalog-react';\nimport { createFromTemplateRouteRef, viewTechDocRouteRef } from '../../routes';\n\nimport { AboutContent } from './AboutContent';\nimport CachedIcon from '@material-ui/icons/Cached';\nimport CreateComponentIcon from '@material-ui/icons/AddCircleOutline';\nimport DocsIcon from '@material-ui/icons/Description';\nimport EditIcon from '@material-ui/icons/Edit';\nimport { isTemplateEntityV1beta3 } from '@backstage/plugin-scaffolder-common';\nimport { useEntityPermission } from '@backstage/plugin-catalog-react/alpha';\nimport { catalogEntityRefreshPermission } from '@backstage/plugin-catalog-common/alpha';\nimport { useSourceTemplateCompoundEntityRef } from './hooks';\nimport { taskCreatePermission } from '@backstage/plugin-scaffolder-common/alpha';\nimport { usePermission } from '@backstage/plugin-permission-react';\nimport { catalogTranslationRef } from '../../alpha/translation';\nimport { useTranslationRef } from '@backstage/core-plugin-api/alpha';\n\nconst TECHDOCS_ANNOTATION = 'backstage.io/techdocs-ref';\n\nconst TECHDOCS_EXTERNAL_ANNOTATION = 'backstage.io/techdocs-entity';\n\nconst useStyles = makeStyles({\n  gridItemCard: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: 'calc(100% - 10px)', // for pages without content header\n    marginBottom: '10px',\n  },\n  fullHeightCard: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: '100%',\n  },\n  gridItemCardContent: {\n    flex: 1,\n  },\n  fullHeightCardContent: {\n    flex: 1,\n  },\n});\n\n/**\n * Props for {@link EntityAboutCard}.\n *\n * @public\n */\nexport interface AboutCardProps {\n  variant?: InfoCardVariants;\n}\n\n/**\n * Exported publicly via the EntityAboutCard\n *\n * NOTE: We generally do not accept pull requests to extend this class with more\n * props and cusomizability. If you need to tweak it, consider making a bespoke\n * card in your own repository instead, that is perfect for your own needs.\n */\nexport function AboutCard(props: AboutCardProps) {\n  const { variant } = props;\n  const app = useApp();\n  const classes = useStyles();\n  const { entity } = useEntity();\n  const scmIntegrationsApi = useApi(scmIntegrationsApiRef);\n  const catalogApi = useApi(catalogApiRef);\n  const alertApi = useApi(alertApiRef);\n  const errorApi = useApi(errorApiRef);\n  const viewTechdocLink = useRouteRef(viewTechDocRouteRef);\n  const templateRoute = useRouteRef(createFromTemplateRouteRef);\n  const sourceTemplateRef = useSourceTemplateCompoundEntityRef(entity);\n  const { allowed: canRefresh } = useEntityPermission(\n    catalogEntityRefreshPermission,\n  );\n  const { t } = useTranslationRef(catalogTranslationRef);\n\n  const { allowed: canCreateTemplateTask } = usePermission({\n    permission: taskCreatePermission,\n  });\n\n  const entitySourceLocation = getEntitySourceLocation(\n    entity,\n    scmIntegrationsApi,\n  );\n  const entityMetadataEditUrl =\n    entity.metadata.annotations?.[ANNOTATION_EDIT_URL];\n\n  let techdocsRef: CompoundEntityRef | undefined;\n\n  if (entity.metadata.annotations?.[TECHDOCS_EXTERNAL_ANNOTATION]) {\n    try {\n      techdocsRef = parseEntityRef(\n        entity.metadata.annotations?.[TECHDOCS_EXTERNAL_ANNOTATION],\n      );\n      // not a fan of this but we don't care if the parseEntityRef fails\n    } catch {\n      techdocsRef = undefined;\n    }\n  }\n\n  const viewInSource: IconLinkVerticalProps = {\n    label: t('aboutCard.viewSource'),\n    disabled: !entitySourceLocation,\n    icon: <ScmIntegrationIcon type={entitySourceLocation?.integrationType} />,\n    href: entitySourceLocation?.locationTargetUrl,\n  };\n  const viewInTechDocs: IconLinkVerticalProps = {\n    label: t('aboutCard.viewTechdocs'),\n    disabled:\n      !(\n        entity.metadata.annotations?.[TECHDOCS_ANNOTATION] ||\n        entity.metadata.annotations?.[TECHDOCS_EXTERNAL_ANNOTATION]\n      ) || !viewTechdocLink,\n    icon: <DocsIcon />,\n    href:\n      viewTechdocLink &&\n      (techdocsRef\n        ? viewTechdocLink({\n            namespace: techdocsRef.namespace || DEFAULT_NAMESPACE,\n            kind: techdocsRef.kind,\n            name: techdocsRef.name,\n          })\n        : viewTechdocLink({\n            namespace: entity.metadata.namespace || DEFAULT_NAMESPACE,\n            kind: entity.kind,\n            name: entity.metadata.name,\n          })),\n  };\n\n  const subHeaderLinks = [viewInSource, viewInTechDocs];\n\n  if (isTemplateEntityV1beta3(entity)) {\n    const Icon = app.getSystemIcon('scaffolder') ?? CreateComponentIcon;\n\n    const launchTemplate: IconLinkVerticalProps = {\n      label: t('aboutCard.launchTemplate'),\n      icon: <Icon />,\n      disabled: !templateRoute || !canCreateTemplateTask,\n      href:\n        templateRoute &&\n        templateRoute({\n          templateName: entity.metadata.name,\n          namespace: entity.metadata.namespace || DEFAULT_NAMESPACE,\n        }),\n    };\n\n    subHeaderLinks.push(launchTemplate);\n  }\n\n  let cardClass = '';\n  if (variant === 'gridItem') {\n    cardClass = classes.gridItemCard;\n  } else if (variant === 'fullHeight') {\n    cardClass = classes.fullHeightCard;\n  }\n\n  let cardContentClass = '';\n  if (variant === 'gridItem') {\n    cardContentClass = classes.gridItemCardContent;\n  } else if (variant === 'fullHeight') {\n    cardContentClass = classes.fullHeightCardContent;\n  }\n\n  const entityLocation = entity.metadata.annotations?.[ANNOTATION_LOCATION];\n  // Limiting the ability to manually refresh to the less expensive locations\n  const allowRefresh =\n    entityLocation?.startsWith('url:') || entityLocation?.startsWith('file:');\n  const refreshEntity = useCallback(async () => {\n    try {\n      await catalogApi.refreshEntity(stringifyEntityRef(entity));\n      alertApi.post({\n        message: t('aboutCard.refreshScheduledMessage'),\n        severity: 'info',\n        display: 'transient',\n      });\n    } catch (e) {\n      errorApi.post(e);\n    }\n  }, [catalogApi, entity, alertApi, t, errorApi]);\n\n  return (\n    <Card className={cardClass}>\n      <CardHeader\n        title={t('aboutCard.title')}\n        action={\n          <>\n            {allowRefresh && canRefresh && (\n              <IconButton\n                aria-label=\"Refresh\"\n                title={t('aboutCard.refreshButtonTitle')}\n                onClick={refreshEntity}\n              >\n                <CachedIcon />\n              </IconButton>\n            )}\n            <IconButton\n              component={Link}\n              aria-label=\"Edit\"\n              disabled={!entityMetadataEditUrl}\n              title={t('aboutCard.editButtonTitle')}\n              to={entityMetadataEditUrl ?? '#'}\n            >\n              <EditIcon />\n            </IconButton>\n            {sourceTemplateRef && templateRoute && (\n              <IconButton\n                component={Link}\n                title={t('aboutCard.createSimilarButtonTitle')}\n                to={templateRoute({\n                  namespace: sourceTemplateRef.namespace,\n                  templateName: sourceTemplateRef.name,\n                })}\n              >\n                <AppIcon id=\"scaffolder\" />\n              </IconButton>\n            )}\n          </>\n        }\n        subheader={<HeaderIconLinkRow links={subHeaderLinks} />}\n      />\n      <Divider />\n      <CardContent className={cardContentClass}>\n        <AboutContent entity={entity} />\n      </CardContent>\n    </Card>\n  );\n}\n"],"names":[],"mappings":"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"}