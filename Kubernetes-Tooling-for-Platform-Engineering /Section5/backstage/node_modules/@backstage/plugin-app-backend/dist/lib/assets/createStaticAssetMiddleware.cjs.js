'use strict';

var path = require('path');
var headers = require('../headers.cjs.js');

function createStaticAssetMiddleware(store) {
  return (req, res, next) => {
    if (req.method !== "GET" && req.method !== "HEAD") {
      next();
      return;
    }
    Promise.resolve(
      (async () => {
        const path$1 = req.path.startsWith("/") ? req.path.slice(1) : req.path;
        const asset = await store.getAsset(path$1);
        if (!asset) {
          next();
          return;
        }
        const ext = path.extname(asset.path);
        if (ext) {
          res.type(ext);
        } else {
          res.type("bin");
        }
        res.setHeader("Cache-Control", headers.CACHE_CONTROL_MAX_CACHE);
        res.setHeader("Last-Modified", asset.lastModifiedAt.toUTCString());
        res.send(asset.content);
      })()
    ).catch(next);
  };
}

exports.createStaticAssetMiddleware = createStaticAssetMiddleware;
//# sourceMappingURL=createStaticAssetMiddleware.cjs.js.map
