"use strict";var K=Object.defineProperty;var a=(S,O)=>K(S,"name",{value:O,configurable:!0});const Q=require("./codemirror.cjs2.js"),L=require("./searchcursor.cjs2.js"),z=require("./dialog.cjs.js");function U(S,O){for(var i=0;i<O.length;i++){const y=O[i];if(typeof y!="string"&&!Array.isArray(y)){for(const v in y)if(v!=="default"&&!(v in S)){const h=Object.getOwnPropertyDescriptor(y,v);h&&Object.defineProperty(S,v,h.get?h:{enumerable:!0,get:()=>y[v]})}}}return Object.freeze(Object.defineProperty(S,Symbol.toStringTag,{value:"Module"}))}a(U,"_mergeNamespaces");var B={exports:{}};(function(S,O){(function(i){i(Q.requireCodemirror(),L.requireSearchcursor(),z.dialogExports)})(function(i){i.defineOption("search",{bottom:!1});function y(e,n){return typeof e=="string"?e=new RegExp(e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n?"gi":"g"):e.global||(e=new RegExp(e.source,e.ignoreCase?"gi":"g")),{token:function(t){e.lastIndex=t.pos;var o=e.exec(t.string);if(o&&o.index==t.pos)return t.pos+=o[0].length||1,"searching";o?t.pos=o.index:t.skipToEnd()}}}a(y,"searchOverlay");function v(){this.posFrom=this.posTo=this.lastQuery=this.query=null,this.overlay=null}a(v,"SearchState");function h(e){return e.state.search||(e.state.search=new v)}a(h,"getSearchState");function m(e){return typeof e=="string"&&e==e.toLowerCase()}a(m,"queryCaseInsensitive");function N(e,n,t){return e.getSearchCursor(n,t,{caseFold:m(n),multiline:!0})}a(N,"getSearchCursor");function j(e,n,t,o,r){e.openDialog(n,o,{value:t,selectValueOnOpen:!0,closeOnEnter:!1,onClose:function(){w(e)},onKeyDown:r,bottom:e.options.search.bottom})}a(j,"persistentDialog");function D(e,n,t,o,r){e.openDialog?e.openDialog(n,r,{value:o,selectValueOnOpen:!0,bottom:e.options.search.bottom}):r(prompt(t,o))}a(D,"dialog");function k(e,n,t,o){e.openConfirm?e.openConfirm(n,o):confirm(t)&&o[0]()}a(k,"confirmDialog");function C(e){return e.replace(/\\([nrt\\])/g,function(n,t){return t=="n"?`
`:t=="r"?"\r":t=="t"?"	":t=="\\"?"\\":n})}a(C,"parseString");function T(e){var n=e.match(/^\/(.*)\/([a-z]*)$/);if(n)try{e=new RegExp(n[1],n[2].indexOf("i")==-1?"":"i")}catch{}else e=C(e);return(typeof e=="string"?e=="":e.test(""))&&(e=/x^/),e}a(T,"parseQuery");function P(e,n,t){n.queryText=t,n.query=T(t),e.removeOverlay(n.overlay,m(n.query)),n.overlay=y(n.query,m(n.query)),e.addOverlay(n.overlay),e.showMatchesOnScrollbar&&(n.annotate&&(n.annotate.clear(),n.annotate=null),n.annotate=e.showMatchesOnScrollbar(n.query,m(n.query)))}a(P,"startSearch");function b(e,n,t,o){var r=h(e);if(r.query)return R(e,n);var s=e.getSelection()||r.lastQuery;if(s instanceof RegExp&&s.source=="x^"&&(s=null),t&&e.openDialog){var c=null,u=a(function(f,x){i.e_stop(x),f&&(f!=r.queryText&&(P(e,r,f),r.posFrom=r.posTo=e.getCursor()),c&&(c.style.opacity=1),R(e,x.shiftKey,function(d,g){var p;g.line<3&&document.querySelector&&(p=e.display.wrapper.querySelector(".CodeMirror-dialog"))&&p.getBoundingClientRect().bottom-4>e.cursorCoords(g,"window").top&&((c=p).style.opacity=.4)}))},"searchNext");j(e,E(e),s,u,function(f,x){var d=i.keyName(f),g=e.getOption("extraKeys"),p=g&&g[d]||i.keyMap[e.getOption("keyMap")][d];p=="findNext"||p=="findPrev"||p=="findPersistentNext"||p=="findPersistentPrev"?(i.e_stop(f),P(e,h(e),x),e.execCommand(p)):(p=="find"||p=="findPersistent")&&(i.e_stop(f),u(x,f))}),o&&s&&(P(e,r,s),R(e,n))}else D(e,E(e),"Search for:",s,function(f){f&&!r.query&&e.operation(function(){P(e,r,f),r.posFrom=r.posTo=e.getCursor(),R(e,n)})})}a(b,"doSearch");function R(e,n,t){e.operation(function(){var o=h(e),r=N(e,o.query,n?o.posFrom:o.posTo);!r.find(n)&&(r=N(e,o.query,n?i.Pos(e.lastLine()):i.Pos(e.firstLine(),0)),!r.find(n))||(e.setSelection(r.from(),r.to()),e.scrollIntoView({from:r.from(),to:r.to()},20),o.posFrom=r.from(),o.posTo=r.to(),t&&t(r.from(),r.to()))})}a(R,"findNext");function w(e){e.operation(function(){var n=h(e);n.lastQuery=n.query,n.query&&(n.query=n.queryText=null,e.removeOverlay(n.overlay),n.annotate&&(n.annotate.clear(),n.annotate=null))})}a(w,"clearSearch");function l(e,n){var t=e?document.createElement(e):document.createDocumentFragment();for(var o in n)t[o]=n[o];for(var r=2;r<arguments.length;r++){var s=arguments[r];t.appendChild(typeof s=="string"?document.createTextNode(s):s)}return t}a(l,"el");function E(e){return l("",null,l("span",{className:"CodeMirror-search-label"},e.phrase("Search:"))," ",l("input",{type:"text",style:"width: 10em",className:"CodeMirror-search-field"})," ",l("span",{style:"color: #888",className:"CodeMirror-search-hint"},e.phrase("(Use /re/ syntax for regexp search)")))}a(E,"getQueryDialog");function A(e){return l("",null," ",l("input",{type:"text",style:"width: 10em",className:"CodeMirror-search-field"})," ",l("span",{style:"color: #888",className:"CodeMirror-search-hint"},e.phrase("(Use /re/ syntax for regexp search)")))}a(A,"getReplaceQueryDialog");function I(e){return l("",null,l("span",{className:"CodeMirror-search-label"},e.phrase("With:"))," ",l("input",{type:"text",style:"width: 10em",className:"CodeMirror-search-field"}))}a(I,"getReplacementQueryDialog");function V(e){return l("",null,l("span",{className:"CodeMirror-search-label"},e.phrase("Replace?"))," ",l("button",{},e.phrase("Yes"))," ",l("button",{},e.phrase("No"))," ",l("button",{},e.phrase("All"))," ",l("button",{},e.phrase("Stop")))}a(V,"getDoReplaceConfirm");function _(e,n,t){e.operation(function(){for(var o=N(e,n);o.findNext();)if(typeof n!="string"){var r=e.getRange(o.from(),o.to()).match(n);o.replace(t.replace(/\$(\d)/g,function(s,c){return r[c]}))}else o.replace(t)})}a(_,"replaceAll");function F(e,n){if(!e.getOption("readOnly")){var t=e.getSelection()||h(e).lastQuery,o=n?e.phrase("Replace all:"):e.phrase("Replace:"),r=l("",null,l("span",{className:"CodeMirror-search-label"},o),A(e));D(e,r,o,t,function(s){s&&(s=T(s),D(e,I(e),e.phrase("Replace with:"),"",function(c){if(c=C(c),n)_(e,s,c);else{w(e);var u=N(e,s,e.getCursor("from")),f=a(function(){var d=u.from(),g;!(g=u.findNext())&&(u=N(e,s),!(g=u.findNext())||d&&u.from().line==d.line&&u.from().ch==d.ch)||(e.setSelection(u.from(),u.to()),e.scrollIntoView({from:u.from(),to:u.to()}),k(e,V(e),e.phrase("Replace?"),[function(){x(g)},f,function(){_(e,s,c)}]))},"advance"),x=a(function(d){u.replace(typeof s=="string"?c:c.replace(/\$(\d)/g,function(g,p){return d[p]})),f()},"doReplace");f()}}))})}}a(F,"replace"),i.commands.find=function(e){w(e),b(e)},i.commands.findPersistent=function(e){w(e),b(e,!1,!0)},i.commands.findPersistentNext=function(e){b(e,!1,!0,!0)},i.commands.findPersistentPrev=function(e){b(e,!0,!0,!0)},i.commands.findNext=b,i.commands.findPrev=function(e){b(e,!0)},i.commands.clearSearch=w,i.commands.replace=F,i.commands.replaceAll=function(e){F(e,!0)}})})();var $=B.exports;const W=Q.getDefaultExportFromCjs($),Y=U({__proto__:null,default:W},[$]);exports.search=Y;
//# sourceMappingURL=search.cjs.js.map
