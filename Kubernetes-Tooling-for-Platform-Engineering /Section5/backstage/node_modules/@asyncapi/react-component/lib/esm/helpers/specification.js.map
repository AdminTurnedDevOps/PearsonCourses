{"version":3,"file":"specification.js","sourceRoot":"","sources":["../../../src/helpers/specification.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  AsyncAPIDocumentInterface,\n  TagInterface,\n  isAsyncAPIDocument,\n  isOldAsyncAPIDocument,\n  toAsyncAPIDocument,\n  unstringify,\n} from '@asyncapi/parser';\nimport { isStringifiedDocument } from '@asyncapi/parser/cjs/document';\n\n// eslint-disable-next-line @typescript-eslint/no-extraneous-class\nexport class SpecificationHelpers {\n  /**\n   * Returns parsed AsyncAPI specification.\n   */\n  static retrieveParsedSpec(\n    schema: unknown,\n  ): AsyncAPIDocumentInterface | undefined {\n    if (!schema) {\n      return undefined;\n    }\n\n    if (isAsyncAPIDocument(schema)) {\n      return schema;\n    }\n\n    if (isOldAsyncAPIDocument(schema)) {\n      // Is from old parser\n      const parsedJSON = schema.json();\n      return toAsyncAPIDocument(parsedJSON);\n    }\n\n    // check if input is a string and try parse it\n    if (typeof schema === 'string') {\n      try {\n        schema = JSON.parse(schema) as Record<string, unknown>;\n      } catch (e) {\n        return undefined;\n      }\n    }\n\n    // at the end check if schema is a parsed JS object (as output from AsyncAPI Parser)\n    if (isStringifiedDocument(schema)) {\n      return unstringify(schema);\n    }\n\n    return toAsyncAPIDocument(schema);\n  }\n\n  /**\n   * Check if given schema have one of the specified tags.\n   */\n  static containTags(\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    schema: any,\n    tags: TagInterface | TagInterface[],\n  ): boolean {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n    const tagsToCheck =\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-call\n      typeof schema.tags === 'function' ? schema.tags() : undefined;\n    if (tagsToCheck === undefined || !Array.isArray(tagsToCheck)) {\n      return false;\n    }\n    const tagsArr = Array.isArray(tags) ? tags : [tags];\n    return tagsToCheck.some((tag: TagInterface) =>\n      tagsArr.some((t) => t.name() === tag.name()),\n    );\n  }\n\n  /**\n   * Return all tags from operations\n   */\n  static operationsTags(spec: AsyncAPIDocumentInterface) {\n    const tags = new Map<string, TagInterface>();\n    Object.entries(spec.operations().all()).forEach(([, operation]) => {\n      if (operation?.tags().length > 0) {\n        operation\n          .tags()\n          .all()\n          .forEach((tag) => tags.set(tag.name(), tag));\n      }\n    });\n    return Array.from(tags.values());\n  }\n\n  /**\n   * Return all tags from servers\n   */\n  static serversTags(spec: AsyncAPIDocumentInterface) {\n    const tags: Record<string, string[]> = {};\n    Object.entries(spec.servers()).forEach(([_, server]) => {\n      if (server.tags().length > 0) {\n        server\n          .tags()\n          .all()\n          .forEach((tag) => {\n            if (tags[tag.name()]) {\n              tags[tag.name()].push(_);\n            } else {\n              tags[tag.name()] = [_];\n            }\n          });\n      }\n    });\n    return tags;\n  }\n}\n"]}